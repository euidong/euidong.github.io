<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta property="og:description" content="Network ë¶„ì•¼ì— ê´€ì‹¬ì´ ë§ì€ ê°œë°œìë¡œ Computer Engineering ê´€ë ¨ Postingì„ ì£¼ë¡œ ë‹¤ë£¹ë‹ˆë‹¤."/><meta property="og:type" content="blog"/><meta property="og:site_name" content="JustLog"/><meta property="og:image" content="https://euidong.github.io/logo192.png"/><title>[Docker] Network(1)</title><meta property="og:title" content="[Docker] Network(1)"/><meta name="description" content="Docker Swarmì„ docker stackì„ ì´ìš©í•˜ì—¬ ì‹¤í–‰ì‹œí‚¤ê²Œ ëœë‹¤ë©´, ë¬´ì—‡ì´ ìƒì„±ë˜ëŠ”ê°€? ìš°ë¦¬ëŠ” ì„œë¹„ìŠ¤ê°€ ìƒì„±ë˜ê¸°ë„ ì „ì— networkê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ê°€ ìˆë‹¤. containerì™€ containerê°„ ê·¸ë¦¬ê³ , hostë¥¼ í†µí•´ ì™¸ë¶€ internetí™˜ê²½ì— containerë¥¼ ì—°ê²° ì‹œí‚¤ëŠ” ëª¨ë“  ê³¼ì •ì„ ì•Œì•„ë³´ì.Dockerë¥¼ ì‚¬ìš©í•˜ë‹¤ë³´ë©´, hostì™€ í†µì‹ ì„ ìœ„í•´ ì™¸ë¶€ë¡œ portë¥¼ ì—´ì–´ì£¼ëŠ” ê²ƒê³¼ container ê°„ì˜ í†µì‹ ì„ í—·ê°ˆë ¤ í•˜ëŠ” ì‚¬ëŒë“¤ì´ ìƒê°ë³´ë‹¤ ë§ì€ ê²ƒ ê°™ë‹¤. ì‹¬ì§€ì–´ëŠ” containerê°„ í†µì‹ ì„ ìœ„í•´ì„œ localhostë¡œ ì •ë³´ë¥¼ ì£¼ê³ ë°›ì„ë ¤ê³  í•˜ëŠ” ëª¹ì“¸ ì‹œë„ë¥¼ í•˜ëŠ” ê´€ê²½ë„ ëª‡ëª‡ ë´ì™”ë‹¤.ë”°ë¼ì„œ, ìš°ë¦¬ëŠ” í•œ ë²ˆ Dockerì˜ networkì— ëŒ€í•´ì„œ í•œ ë²ˆ ê³µë¶€í•´ë³´ëŠ” ê²ƒì´ ì¢‹ì„ ê²ƒì´ë‹¤.í•´ë‹¹ ì°¨ì‹œì—ì„œëŠ” ìš°ì„  ì „ì²´ì ì¸ docker networkë¥¼ ì„¤ëª…í•˜ëŠ” ê¸°ë³¸ì ì¸ í‚¤ì›Œë“œë¥¼ ì•Œì•„ë³¼ ê²ƒì´ê³ ,2 ì°¨ì‹œì—ì„œëŠ” ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ” docker network driverë¥¼ ì•Œì•„ë³¼ ê²ƒì´ê³ ,3 ì°¨ì‹œì—ì„œëŠ” libnetworkì˜ í•µì‹¬ ê¸°ëŠ¥ ì¤‘ service discovery, load balancingì— ëŒ€í•´ì„œ ì•Œì•„ë³´ê² ë‹¤."/><meta property="og:description" content="Docker Swarmì„ docker stackì„ ì´ìš©í•˜ì—¬ ì‹¤í–‰ì‹œí‚¤ê²Œ ëœë‹¤ë©´, ë¬´ì—‡ì´ ìƒì„±ë˜ëŠ”ê°€? ìš°ë¦¬ëŠ” ì„œë¹„ìŠ¤ê°€ ìƒì„±ë˜ê¸°ë„ ì „ì— networkê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ê°€ ìˆë‹¤. containerì™€ containerê°„ ê·¸ë¦¬ê³ , hostë¥¼ í†µí•´ ì™¸ë¶€ internetí™˜ê²½ì— containerë¥¼ ì—°ê²° ì‹œí‚¤ëŠ” ëª¨ë“  ê³¼ì •ì„ ì•Œì•„ë³´ì.Dockerë¥¼ ì‚¬ìš©í•˜ë‹¤ë³´ë©´, hostì™€ í†µì‹ ì„ ìœ„í•´ ì™¸ë¶€ë¡œ portë¥¼ ì—´ì–´ì£¼ëŠ” ê²ƒê³¼ container ê°„ì˜ í†µì‹ ì„ í—·ê°ˆë ¤ í•˜ëŠ” ì‚¬ëŒë“¤ì´ ìƒê°ë³´ë‹¤ ë§ì€ ê²ƒ ê°™ë‹¤. ì‹¬ì§€ì–´ëŠ” containerê°„ í†µì‹ ì„ ìœ„í•´ì„œ localhostë¡œ ì •ë³´ë¥¼ ì£¼ê³ ë°›ì„ë ¤ê³  í•˜ëŠ” ëª¹ì“¸ ì‹œë„ë¥¼ í•˜ëŠ” ê´€ê²½ë„ ëª‡ëª‡ ë´ì™”ë‹¤.ë”°ë¼ì„œ, ìš°ë¦¬ëŠ” í•œ ë²ˆ Dockerì˜ networkì— ëŒ€í•´ì„œ í•œ ë²ˆ ê³µë¶€í•´ë³´ëŠ” ê²ƒì´ ì¢‹ì„ ê²ƒì´ë‹¤.í•´ë‹¹ ì°¨ì‹œì—ì„œëŠ” ìš°ì„  ì „ì²´ì ì¸ docker networkë¥¼ ì„¤ëª…í•˜ëŠ” ê¸°ë³¸ì ì¸ í‚¤ì›Œë“œë¥¼ ì•Œì•„ë³¼ ê²ƒì´ê³ ,2 ì°¨ì‹œì—ì„œëŠ” ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ” docker network driverë¥¼ ì•Œì•„ë³¼ ê²ƒì´ê³ ,3 ì°¨ì‹œì—ì„œëŠ” libnetworkì˜ í•µì‹¬ ê¸°ëŠ¥ ì¤‘ service discovery, load balancingì— ëŒ€í•´ì„œ ì•Œì•„ë³´ê² ë‹¤."/><meta property="og:url" content="https://euidong.github.io/posts/docker-network-1"/><link rel="canonical" href="https://euidong.github.io/posts/docker-network-1"/><meta property="og:image" content="https://euidong.github.io/images/docker-picture.jpg"/><meta name="next-head-count" content="13"/><link rel="icon" href="https://euidong.github.io/favicon.png"/><link rel="apple-touch-icon" href="https://euidong.github.io/logo192.png"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7452732177557701" crossorigin="anonymous"></script><link rel="preload" href="/_next/static/css/d4ec5c8b3df09443.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d4ec5c8b3df09443.css" data-n-g=""/><link rel="preload" href="/_next/static/css/4e506edd7924fba2.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4e506edd7924fba2.css" data-n-p=""/><link rel="preload" href="/_next/static/css/936c1a0848bb34d6.css" as="style"/><link rel="stylesheet" href="/_next/static/css/936c1a0848bb34d6.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-9b312e20a4e32339.js" defer=""></script><script src="/_next/static/chunks/framework-81da43a8dcd978d9.js" defer=""></script><script src="/_next/static/chunks/main-7b6c38cbad60dfcf.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6f29cee1d0ed370b.js" defer=""></script><script src="/_next/static/chunks/78e521c3-cbc72355a4ceeb71.js" defer=""></script><script src="/_next/static/chunks/175675d1-f160d4a5df49f5d3.js" defer=""></script><script src="/_next/static/chunks/675-ae8e8a351ce30ae2.js" defer=""></script><script src="/_next/static/chunks/602-aae13ef79a8283ee.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-3a18390189e5c715.js" defer=""></script><script src="/_next/static/zSWbHNES18aBYgh7F-mxp/_buildManifest.js" defer=""></script><script src="/_next/static/zSWbHNES18aBYgh7F-mxp/_ssgManifest.js" defer=""></script><script src="/_next/static/zSWbHNES18aBYgh7F-mxp/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div class="Layout_wrapper__dKJSz root"><header class="Layout_header__XosLl" style="position:sticky"><div><button tabindex="1" class="SideBarToggler_search_bar_toggler__CEuUg"><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 24 24" height="35px" width="35px" xmlns="http://www.w3.org/2000/svg"><path d="M2 6C2 5.44772 2.44772 5 3 5H21C21.5523 5 22 5.44772 22 6C22 6.55228 21.5523 7 21 7H3C2.44772 7 2 6.55228 2 6Z" fill="currentColor"></path><path d="M2 12.0322C2 11.4799 2.44772 11.0322 3 11.0322H21C21.5523 11.0322 22 11.4799 22 12.0322C22 12.5845 21.5523 13.0322 21 13.0322H3C2.44772 13.0322 2 12.5845 2 12.0322Z" fill="currentColor"></path><path d="M3 17.0645C2.44772 17.0645 2 17.5122 2 18.0645C2 18.6167 2.44772 19.0645 3 19.0645H21C21.5523 19.0645 22 18.6167 22 18.0645C22 17.5122 21.5523 17.0645 21 17.0645H3Z" fill="currentColor"></path></svg></button><nav class="SideBar_side_bar__wrapper--close__8Nwnr"><a class="SideBar_side_bar__li__crDBH" tabindex="-1" href="/">Home</a><a class="SideBar_side_bar__li__crDBH" tabindex="-1" href="/tags">Tags</a><a class="SideBar_side_bar__li__crDBH" tabindex="-1" href="/categories/Algorithm">Algorithm<!-- --><span class="SideBar_side_bar__li__cnt__9QV_z">(<!-- -->11<!-- -->)<!-- --></span></a><a class="SideBar_side_bar__li__crDBH" tabindex="-1" href="/categories/Computer%20Architecture">Computer Architecture<!-- --><span class="SideBar_side_bar__li__cnt__9QV_z">(<!-- -->7<!-- -->)<!-- --></span></a><a class="SideBar_side_bar__li__crDBH" tabindex="-1" href="/categories/Tech">Tech<!-- --><span class="SideBar_side_bar__li__cnt__9QV_z">(<!-- -->16<!-- -->)<!-- --></span></a><a class="SideBar_side_bar__li__crDBH" tabindex="-1" href="/categories/Web">Web<!-- --><span class="SideBar_side_bar__li__cnt__9QV_z">(<!-- -->4<!-- -->)<!-- --></span></a><a class="SideBar_side_bar__li__crDBH" tabindex="-1" href="/categories/Network">Network<!-- --><span class="SideBar_side_bar__li__cnt__9QV_z">(<!-- -->11<!-- -->)<!-- --></span></a><a class="SideBar_side_bar__li__crDBH" tabindex="-1" href="/categories/AI">AI<!-- --><span class="SideBar_side_bar__li__cnt__9QV_z">(<!-- -->7<!-- -->)<!-- --></span></a><a class="SideBar_side_bar__li__crDBH" tabindex="-1" href="/categories/Paper">Paper<!-- --><span class="SideBar_side_bar__li__cnt__9QV_z">(<!-- -->1<!-- -->)<!-- --></span></a></nav></div><a class="Logo_logo___yD0t" tabindex="1" href="/"></a><div><button class="SearchBarToggler_search_bar_toggler__3dHbA" tabindex="2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="25px" width="25px" xmlns="http://www.w3.org/2000/svg"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"></path></svg></button></div></header><section><div class="Post_post__wrapper__Qq8vV"><h1 class="Post_post__title__CYNLY">[Docker] Network(1)</h1><p class="Post_post__date__Sx37s">2021ë…„ 7ì›” 10ì¼ 21ì‹œ 21ë¶„</p><ul class="Post_post__tags__SU5Ql"><li class="Post_post__tags__element__SYmey"># Docker</li><li class="Post_post__tags__element__SYmey"># Container</li><li class="Post_post__tags__element__SYmey"># Network</li></ul><article class="markdown-body MarkDown_markdown-body__ABwUt"><h2>Intro<!-- --></h2>
<!-- --><p>Docker Swarmì„ docker stackì„ ì´ìš©í•˜ì—¬ ì‹¤í–‰ì‹œí‚¤ê²Œ ëœë‹¤ë©´, ë¬´ì—‡ì´ ìƒì„±ë˜ëŠ”ê°€? ìš°ë¦¬ëŠ” ì„œë¹„ìŠ¤ê°€ ìƒì„±ë˜ê¸°ë„ ì „ì— networkê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ê°€ ìˆë‹¤. containerì™€ containerê°„ ê·¸ë¦¬ê³ , hostë¥¼ í†µí•´ ì™¸ë¶€ internetí™˜ê²½ì— containerë¥¼ ì—°ê²° ì‹œí‚¤ëŠ” ëª¨ë“  ê³¼ì •ì„ ì•Œì•„ë³´ì.<!-- --></p>
<!-- --><p>Dockerë¥¼ ì‚¬ìš©í•˜ë‹¤ë³´ë©´, hostì™€ í†µì‹ ì„ ìœ„í•´ ì™¸ë¶€ë¡œ portë¥¼ ì—´ì–´ì£¼ëŠ” ê²ƒê³¼ container ê°„ì˜ í†µì‹ ì„ í—·ê°ˆë ¤ í•˜ëŠ” ì‚¬ëŒë“¤ì´ ìƒê°ë³´ë‹¤ ë§ì€ ê²ƒ ê°™ë‹¤. ì‹¬ì§€ì–´ëŠ” containerê°„ í†µì‹ ì„ ìœ„í•´ì„œ localhostë¡œ ì •ë³´ë¥¼ ì£¼ê³ ë°›ì„ë ¤ê³  í•˜ëŠ” ëª¹ì“¸ ì‹œë„ë¥¼ í•˜ëŠ” ê´€ê²½ë„ ëª‡ëª‡ ë´ì™”ë‹¤.<!-- --></p>
<!-- --><p>ë”°ë¼ì„œ, ìš°ë¦¬ëŠ” í•œ ë²ˆ Dockerì˜ networkì— ëŒ€í•´ì„œ í•œ ë²ˆ ê³µë¶€í•´ë³´ëŠ” ê²ƒì´ ì¢‹ì„ ê²ƒì´ë‹¤.<!-- --></p>
<!-- --><p>í•´ë‹¹ ì°¨ì‹œì—ì„œëŠ” ìš°ì„  ì „ì²´ì ì¸ docker networkë¥¼ ì„¤ëª…í•˜ëŠ” ê¸°ë³¸ì ì¸ í‚¤ì›Œë“œë¥¼ ì•Œì•„ë³¼ ê²ƒì´ê³ ,<!-- --></p>
<!-- --><p>2 ì°¨ì‹œì—ì„œëŠ” ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ” docker network driverë¥¼ ì•Œì•„ë³¼ ê²ƒì´ê³ ,<!-- --></p>
<!-- --><p>3 ì°¨ì‹œì—ì„œëŠ” libnetworkì˜ í•µì‹¬ ê¸°ëŠ¥ ì¤‘ service discovery, load balancingì— ëŒ€í•´ì„œ ì•Œì•„ë³´ê² ë‹¤.<!-- --></p>
<!-- --><h2>Docker Networking Base<!-- --></h2>
<!-- --><p>ìš°ë¦¬ê°€ ê¸°ì–µí•´ì•¼ í•  ê²ƒì€ CNM, libnetwork, Driver ì´ë ‡ê²Œ 3ê°€ì§€ë‹¤. ê° ê°ì´ ë¬´ì—‡ì¸ì§€ëŠ” ì°¨ë¡€ì°¨ë¡€ ì•Œì•„ë³´ì.<!-- --></p>
<!-- --><h3>Container Network Model (CNM)<!-- --></h3>
<!-- --><p>containerê°„ì˜ networkë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•œ designì„ ì œì‹œí•œ ë‚´ìš©ì…ë‹ˆë‹¤. ë”°ë¼ì„œ, ideaì¼ ë¿ì…ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ í•˜ìœ„ ë§í¬ë¥¼ í†µí•´ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.<!-- --></p>
<!-- --><p><a href="https://github.com/moby/libnetwork/blob/master/docs/design.md">ğŸ”— Github - moby/libnetwork<!-- --></a></p>
<!-- --><p>í•˜ì§€ë§Œ, ì´ë¥¼ ì¢€ ë” ìš”ì•½í•´ë´…ì‹œë‹¤. ì¼ë‹¨ í•µì‹¬ ìš”ì†Œ 3ê°€ì§€ë¥¼ ë¨¼ì € ì´í•´í•´ë´…ì‹œë‹¤.<!-- --></p>
<!-- --><ul>
<!-- --><li><strong>Sandbox<!-- --></strong> : ê³ ë¦½ëœ í•˜ë‚˜ì˜ Network ê³µê°„ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. í•´ë‹¹ ê³µê°„ì—ëŠ” ehternet interfaceë‚˜ port ê·¸ë¦¬ê³  routing tableê°™ì€ êµ¬í˜„ì´ í¬í•¨ë©ë‹ˆë‹¤.<!-- --></li>
<!-- --><li><strong>Endpoints<!-- --></strong>Â : Virtual Networkë¥¼ ì„œë¡œ ì—°ê²°í•˜ëŠ” interfaceì˜ ì—­í• ì…ë‹ˆë‹¤. (vethë¼ê³ ë„ ë¶ˆë¦½ë‹ˆë‹¤.) CNMì—ì„œëŠ” Sandbox ë‚´ë¶€ì—ì„œ ì´ì™€ Networkë¥¼ ì—°ê²°í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.<!-- --></li>
<!-- --><li><strong>Networks<!-- --></strong>Â : Virtual Switchë¡œ ì—¬ê¸°ë©´ ë©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ì„œ ì—¬ëŸ¬ ê°œì˜ endpointsë¥¼ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<!-- --></li>
<!-- --></ul>
<!-- --><p>ì ì´ì œ ì´ë ‡ê²Œ 3ê°œì˜ ë„¤íŠ¸ì›Œí¬ë¥¼ ì •ë¦¬í•˜ë©´, ì´ì œ Container ë‚´ë¶€ì— Sandboxê°€ ì¡´ì¬í•˜ê³ , ê·¸ Sandbox ë‚´ë¶€ì˜ endpointsë¥¼ ì—°ê²°í•˜ëŠ” Networkë¥¼ í†µí•´ì„œ ê²°ë¡ ì ìœ¼ë¡œ Container ê°„ì˜ ì—°ê²°ì„ ìˆ˜í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.<!-- --></p>
<!-- --><p><img src="/images/cnm.jpeg" alt="cnm"/></p>
<!-- --><h3>libnetwork<!-- --></h3>
<!-- --><p>ìœ„ì—ì„œ ì´ì•¼ê¸°í•œ ê²ƒì²˜ëŸ¼ CNMì€ ë‹¨ìˆœíˆ ideaì¼ ë¿ì…ë‹ˆë‹¤. ì´ë¥¼ êµ¬í˜„í—ˆì—¬ í‘œì¤€í™”ëœ ê²ƒì´ ë°”ë¡œ libnetworkë¼ê³  ìƒê°í•˜ë©´ ë©ë‹ˆë‹¤. ì´ëŠ” Goë¥¼ ì´ìš©í•˜ì—¬ ì‘ì„±ëœ open sourceë¡œ ìœ„ì—ì„œ ì œì‹œí•œ ë§í¬ë¥¼ í†µí•´ì„œ í•´ë‹¹ open sourceì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ì–¸ê¸‰í•œ CNMì„ êµ¬í˜„í•˜ì˜€ê³ , ì¶”ê°€ì ìœ¼ë¡œ service discovery, ingress-based container load balancing, network control plane ë° management plane ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ì˜€ë‹¤. í˜„ì¬ì—ëŠ” dockerì—ì„œ network êµ¬í˜„ì— ì‚¬ìš©ëœë‹¤.<!-- --></p>
<!-- --><p>* control &amp; management plane : ì§ì ‘ì ìœ¼ë¡œ networkì˜ íë¦„ì„ ì œì–´í•˜ëŠ” ë‹¨ê³„ë¡œ, routingê³¼ ê°™ì€ ì œì–´ë¥¼ ìˆ˜í–‰í•œë‹¤.<!-- --></p>
<!-- --><h3>Drivers<!-- --></h3>
<!-- --><p>ì¦‰, libnetworkê°€ ì „ì²´ì ì¸ networkì˜ control planeê³¼ management plane ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ì˜€ë‹¤ë©´, driverëŠ” data planeì„ êµ¬í˜„í•œë‹¤. ì¦‰, ì§ì ‘ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰í•œë‹¤. ì´ëŸ¬í•œ ê¸°ëŠ¥ë“¤ì€ dockerì—ì„œ ì—¬ëŸ¬ ê°œì˜ driverë¼ëŠ” submoduleì„ í†µí•´ì„œ êµ¬í˜„í•˜ì˜€ë‹¤. docker pubë¥¼ í†µí•´ì„œ defaultë³´ë‹¤ ë‚˜ì•„ê°„ driver ì—­ì‹œ ì„¤ì¹˜ê°€ ê°€ëŠ¥í•˜ë‹¤. í•˜ì§€ë§Œ ê¸°ë³¸ì ìœ¼ë¡œ, host, bridge, overlay, ipvlan, macvlan ë“±ì„ í¬í•¨í•˜ê³  ìˆë‹¤.<!-- --></p>
<!-- --><p>ì—¬ê¸°ê¹Œì§€ê°€ docker networkì— ëŒ€í•œ overviewì´ë‹¤. ë‹¤ìŒ ì°¨ì‹œì— ê³„ì†...<!-- --></p>
<!-- --><h2>Reference<!-- --></h2>
<!-- --><ul>
<!-- --><li><a href="https://www.oreilly.com/library/view/docker-deep-dive/9781800565135/">ğŸ”— Docker Deep Dive<!-- --></a>, Nigel Poulton<!-- --></li>
<!-- --><li>Tumbnail : Photo by <!-- --><a href="https://unsplash.com/@michael75?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Michael<!-- --></a> on <!-- --><a href="https://unsplash.com/s/photos/cargo-ships?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash<!-- --></a></li>
<!-- --></ul></article><div class="Comment_comment__wrapper___sKTf"><h2 class="Comment_comment__title__hLmXO">Comments</h2><section></section></div><div class="ColumnCard_column_card__list__background__kZObh"><h2 class="ColumnCard_column_card__list__title__pawoL">Related Posts</h2><div class="ColumnCard_column_card__list__wrapper__lsbEP"><div class="ColumnCard_column_card__wrapper__iVPbY"><a class="ColumnCard_column_card__thumbnail__wrapper__M3Kfm" href="/posts/s6-overlay"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27320%27%20height=%27320%27/%3e"/></span><img alt="S6 Overlay" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="ColumnCard_column_card__thumbnail__bx9FL" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover"/><noscript><img alt="S6 Overlay" srcSet="https://euidong.github.io/images/docker-picture.jpg?imwidth=384 1x, https://euidong.github.io/images/docker-picture.jpg?imwidth=640 2x" src="https://euidong.github.io/images/docker-picture.jpg?imwidth=640" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" class="ColumnCard_column_card__thumbnail__bx9FL" loading="lazy"/></noscript></span></a><div class="ColumnCard_column_card__tray__v9oLc"><a class="ColumnCard_column_card__tray__title__fEApg" tabindex="-1" href="/posts/s6-overlay">S6 Overlay</a><ul class="ColumnCard_column_card__tray__tag__UUiD6"><a tabindex="-1" class="ColumnCard_column_card__tray__tag__li__YRXLc" href="/tags/Docker"># <!-- -->Docker<!-- --></a></ul></div></div><div class="ColumnCard_column_card__wrapper__iVPbY"><a class="ColumnCard_column_card__thumbnail__wrapper__M3Kfm" href="/posts/docker-network-2"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27320%27%20height=%27320%27/%3e"/></span><img alt="[Docker] Network(2)" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="ColumnCard_column_card__thumbnail__bx9FL" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover"/><noscript><img alt="[Docker] Network(2)" srcSet="https://euidong.github.io/images/docker-picture.jpg?imwidth=384 1x, https://euidong.github.io/images/docker-picture.jpg?imwidth=640 2x" src="https://euidong.github.io/images/docker-picture.jpg?imwidth=640" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" class="ColumnCard_column_card__thumbnail__bx9FL" loading="lazy"/></noscript></span></a><div class="ColumnCard_column_card__tray__v9oLc"><a class="ColumnCard_column_card__tray__title__fEApg" tabindex="-1" href="/posts/docker-network-2">[Docker] Network(2)</a><ul class="ColumnCard_column_card__tray__tag__UUiD6"><a tabindex="-1" class="ColumnCard_column_card__tray__tag__li__YRXLc" href="/tags/Docker"># <!-- -->Docker<!-- --></a><a tabindex="-1" class="ColumnCard_column_card__tray__tag__li__YRXLc" href="/tags/Container"># <!-- -->Container<!-- --></a><a tabindex="-1" class="ColumnCard_column_card__tray__tag__li__YRXLc" href="/tags/Network"># <!-- -->Network<!-- --></a></ul></div></div><div class="ColumnCard_column_card__wrapper__iVPbY"><a class="ColumnCard_column_card__thumbnail__wrapper__M3Kfm" href="/posts/docker-network-3"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27320%27%20height=%27320%27/%3e"/></span><img alt="[Docker] Network(3)" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="ColumnCard_column_card__thumbnail__bx9FL" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover"/><noscript><img alt="[Docker] Network(3)" srcSet="https://euidong.github.io/images/docker-picture.jpg?imwidth=384 1x, https://euidong.github.io/images/docker-picture.jpg?imwidth=640 2x" src="https://euidong.github.io/images/docker-picture.jpg?imwidth=640" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" class="ColumnCard_column_card__thumbnail__bx9FL" loading="lazy"/></noscript></span></a><div class="ColumnCard_column_card__tray__v9oLc"><a class="ColumnCard_column_card__tray__title__fEApg" tabindex="-1" href="/posts/docker-network-3">[Docker] Network(3)</a><ul class="ColumnCard_column_card__tray__tag__UUiD6"><a tabindex="-1" class="ColumnCard_column_card__tray__tag__li__YRXLc" href="/tags/Docker"># <!-- -->Docker<!-- --></a><a tabindex="-1" class="ColumnCard_column_card__tray__tag__li__YRXLc" href="/tags/Container"># <!-- -->Container<!-- --></a><a tabindex="-1" class="ColumnCard_column_card__tray__tag__li__YRXLc" href="/tags/Network"># <!-- -->Network<!-- --></a></ul></div></div><div class="ColumnCard_column_card__wrapper__iVPbY"><a class="ColumnCard_column_card__thumbnail__wrapper__M3Kfm" href="/posts/docker-security"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27320%27%20height=%27320%27/%3e"/></span><img alt="[Docker] Security" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" class="ColumnCard_column_card__thumbnail__bx9FL" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover"/><noscript><img alt="[Docker] Security" srcSet="https://euidong.github.io/images/docker-picture.jpg?imwidth=384 1x, https://euidong.github.io/images/docker-picture.jpg?imwidth=640 2x" src="https://euidong.github.io/images/docker-picture.jpg?imwidth=640" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" class="ColumnCard_column_card__thumbnail__bx9FL" loading="lazy"/></noscript></span></a><div class="ColumnCard_column_card__tray__v9oLc"><a class="ColumnCard_column_card__tray__title__fEApg" tabindex="-1" href="/posts/docker-security">[Docker] Security</a><ul class="ColumnCard_column_card__tray__tag__UUiD6"><a tabindex="-1" class="ColumnCard_column_card__tray__tag__li__YRXLc" href="/tags/Docker"># <!-- -->Docker<!-- --></a><a tabindex="-1" class="ColumnCard_column_card__tray__tag__li__YRXLc" href="/tags/Container"># <!-- -->Container<!-- --></a><a tabindex="-1" class="ColumnCard_column_card__tray__tag__li__YRXLc" href="/tags/Security"># <!-- -->Security<!-- --></a></ul></div></div></div></div></div></section><footer class="Layout_footer__EL5v8"><div class="Layout_footer__copyright__r5baC"><span>Copyright Â© euidong</span><br/><span>ëª¨ë“  ì»¨í…ì¸ ì— ëŒ€í•œ ì €ì‘ê¶Œì€ ì‘ì„±ìì—ê²Œ ì¡´ì¬í•©ë‹ˆë‹¤. <!-- --><br/>ë¶ˆë²• ë³µì œë¥¼ í†µí•œ ìƒì—…ì  ì‚¬ìš©ì„ ì ˆëŒ€ì ìœ¼ë¡œ ê¸ˆì§€í•©ë‹ˆë‹¤. <!-- --><br/>ë‹¨, ë¹„ìƒì—…ì  ì´ìš©ì˜ ê²½ìš° ì¶œì²˜ ë° ë§í¬ë¥¼ ì ìš©í•œë‹¤ë©´ ììœ ë¡­ê²Œ ì‚¬ìš©ê°€ëŠ¥ í•©ë‹ˆë‹¤.<!-- --></span><span>Also I use photos by<!-- --> <!-- --><a href="https://unsplash.com/@lorenzoherrera?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" tabindex="-1">Lorenzo Herrera</a> <!-- -->on<!-- --> <!-- --><a href="https://unsplash.com/s/photos/tech?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" tabindex="-1">Unsplash</a></span></div><div class="Layout_footer__contents__YZWSm"><a class="Layout_footer__contents__link__K_TKH" href="https://github.com/euidong" target="_blank" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="60" width="60" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg><span>github</span></a><a class="Layout_footer__contents__link__K_TKH" href="https://euidong.github.io/portfolio" target="_blank" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="60" width="60" xmlns="http://www.w3.org/2000/svg"><path d="M6 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-5 6s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H1zM11 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5zm.5 2.5a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1h-4zm2 3a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1h-2zm0 3a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1h-2z"></path></svg><span>portfolio</span></a><a class="Layout_footer__contents__link__K_TKH" href="https://chrome.google.com/webstore/detail/bonfire/nkooidijgbppkojdgkoafcoppnohdfka?hl=ko" target="_blank" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" version="1.1" viewBox="0 0 16 16" height="60" width="60" xmlns="http://www.w3.org/2000/svg"><path d="M5.016 16c-1.066-2.219-0.498-3.49 0.321-4.688 0.897-1.312 1.129-2.61 1.129-2.61s0.706 0.917 0.423 2.352c1.246-1.387 1.482-3.598 1.293-4.445 2.817 1.969 4.021 6.232 2.399 9.392 8.631-4.883 2.147-12.19 1.018-13.013 0.376 0.823 0.448 2.216-0.313 2.893-1.287-4.879-4.468-5.879-4.468-5.879 0.376 2.516-1.364 5.268-3.042 7.324-0.059-1.003-0.122-1.696-0.649-2.656-0.118 1.823-1.511 3.309-1.889 5.135-0.511 2.473 0.383 4.284 3.777 6.197z"></path></svg><span>chat</span></a></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"content":"\n## Intro\n\nDocker Swarmì„ docker stackì„ ì´ìš©í•˜ì—¬ ì‹¤í–‰ì‹œí‚¤ê²Œ ëœë‹¤ë©´, ë¬´ì—‡ì´ ìƒì„±ë˜ëŠ”ê°€? ìš°ë¦¬ëŠ” ì„œë¹„ìŠ¤ê°€ ìƒì„±ë˜ê¸°ë„ ì „ì— networkê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ê°€ ìˆë‹¤. containerì™€ containerê°„ ê·¸ë¦¬ê³ , hostë¥¼ í†µí•´ ì™¸ë¶€ internetí™˜ê²½ì— containerë¥¼ ì—°ê²° ì‹œí‚¤ëŠ” ëª¨ë“  ê³¼ì •ì„ ì•Œì•„ë³´ì.\n\nDockerë¥¼ ì‚¬ìš©í•˜ë‹¤ë³´ë©´, hostì™€ í†µì‹ ì„ ìœ„í•´ ì™¸ë¶€ë¡œ portë¥¼ ì—´ì–´ì£¼ëŠ” ê²ƒê³¼ container ê°„ì˜ í†µì‹ ì„ í—·ê°ˆë ¤ í•˜ëŠ” ì‚¬ëŒë“¤ì´ ìƒê°ë³´ë‹¤ ë§ì€ ê²ƒ ê°™ë‹¤. ì‹¬ì§€ì–´ëŠ” containerê°„ í†µì‹ ì„ ìœ„í•´ì„œ localhostë¡œ ì •ë³´ë¥¼ ì£¼ê³ ë°›ì„ë ¤ê³  í•˜ëŠ” ëª¹ì“¸ ì‹œë„ë¥¼ í•˜ëŠ” ê´€ê²½ë„ ëª‡ëª‡ ë´ì™”ë‹¤.\n\në”°ë¼ì„œ, ìš°ë¦¬ëŠ” í•œ ë²ˆ Dockerì˜ networkì— ëŒ€í•´ì„œ í•œ ë²ˆ ê³µë¶€í•´ë³´ëŠ” ê²ƒì´ ì¢‹ì„ ê²ƒì´ë‹¤.\n\ní•´ë‹¹ ì°¨ì‹œì—ì„œëŠ” ìš°ì„  ì „ì²´ì ì¸ docker networkë¥¼ ì„¤ëª…í•˜ëŠ” ê¸°ë³¸ì ì¸ í‚¤ì›Œë“œë¥¼ ì•Œì•„ë³¼ ê²ƒì´ê³ ,\n\n2 ì°¨ì‹œì—ì„œëŠ” ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ” docker network driverë¥¼ ì•Œì•„ë³¼ ê²ƒì´ê³ ,\n\n3 ì°¨ì‹œì—ì„œëŠ” libnetworkì˜ í•µì‹¬ ê¸°ëŠ¥ ì¤‘ service discovery, load balancingì— ëŒ€í•´ì„œ ì•Œì•„ë³´ê² ë‹¤.\n\n## Docker Networking Base\n\nìš°ë¦¬ê°€ ê¸°ì–µí•´ì•¼ í•  ê²ƒì€ CNM, libnetwork, Driver ì´ë ‡ê²Œ 3ê°€ì§€ë‹¤. ê° ê°ì´ ë¬´ì—‡ì¸ì§€ëŠ” ì°¨ë¡€ì°¨ë¡€ ì•Œì•„ë³´ì.\n\n### Container Network Model (CNM)\n\ncontainerê°„ì˜ networkë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•œ designì„ ì œì‹œí•œ ë‚´ìš©ì…ë‹ˆë‹¤. ë”°ë¼ì„œ, ideaì¼ ë¿ì…ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ í•˜ìœ„ ë§í¬ë¥¼ í†µí•´ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤.\n\n[ğŸ”— Github - moby/libnetwork](https://github.com/moby/libnetwork/blob/master/docs/design.md)\n\ní•˜ì§€ë§Œ, ì´ë¥¼ ì¢€ ë” ìš”ì•½í•´ë´…ì‹œë‹¤. ì¼ë‹¨ í•µì‹¬ ìš”ì†Œ 3ê°€ì§€ë¥¼ ë¨¼ì € ì´í•´í•´ë´…ì‹œë‹¤.\n\n- **Sandbox** : ê³ ë¦½ëœ í•˜ë‚˜ì˜ Network ê³µê°„ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. í•´ë‹¹ ê³µê°„ì—ëŠ” ehternet interfaceë‚˜ port ê·¸ë¦¬ê³  routing tableê°™ì€ êµ¬í˜„ì´ í¬í•¨ë©ë‹ˆë‹¤.\n- **Endpoints**Â : Virtual Networkë¥¼ ì„œë¡œ ì—°ê²°í•˜ëŠ” interfaceì˜ ì—­í• ì…ë‹ˆë‹¤. (vethë¼ê³ ë„ ë¶ˆë¦½ë‹ˆë‹¤.) CNMì—ì„œëŠ” Sandbox ë‚´ë¶€ì—ì„œ ì´ì™€ Networkë¥¼ ì—°ê²°í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.\n- **Networks**Â : Virtual Switchë¡œ ì—¬ê¸°ë©´ ë©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ì„œ ì—¬ëŸ¬ ê°œì˜ endpointsë¥¼ ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì ì´ì œ ì´ë ‡ê²Œ 3ê°œì˜ ë„¤íŠ¸ì›Œí¬ë¥¼ ì •ë¦¬í•˜ë©´, ì´ì œ Container ë‚´ë¶€ì— Sandboxê°€ ì¡´ì¬í•˜ê³ , ê·¸ Sandbox ë‚´ë¶€ì˜ endpointsë¥¼ ì—°ê²°í•˜ëŠ” Networkë¥¼ í†µí•´ì„œ ê²°ë¡ ì ìœ¼ë¡œ Container ê°„ì˜ ì—°ê²°ì„ ìˆ˜í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.\n\n![cnm](/images/cnm.jpeg)\n\n### libnetwork\n\nìœ„ì—ì„œ ì´ì•¼ê¸°í•œ ê²ƒì²˜ëŸ¼ CNMì€ ë‹¨ìˆœíˆ ideaì¼ ë¿ì…ë‹ˆë‹¤. ì´ë¥¼ êµ¬í˜„í—ˆì—¬ í‘œì¤€í™”ëœ ê²ƒì´ ë°”ë¡œ libnetworkë¼ê³  ìƒê°í•˜ë©´ ë©ë‹ˆë‹¤. ì´ëŠ” Goë¥¼ ì´ìš©í•˜ì—¬ ì‘ì„±ëœ open sourceë¡œ ìœ„ì—ì„œ ì œì‹œí•œ ë§í¬ë¥¼ í†µí•´ì„œ í•´ë‹¹ open sourceì— ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœ„ì—ì„œ ì–¸ê¸‰í•œ CNMì„ êµ¬í˜„í•˜ì˜€ê³ , ì¶”ê°€ì ìœ¼ë¡œ service discovery, ingress-based container load balancing, network control plane ë° management plane ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ì˜€ë‹¤. í˜„ì¬ì—ëŠ” dockerì—ì„œ network êµ¬í˜„ì— ì‚¬ìš©ëœë‹¤.\n\n\\* control \u0026 management plane : ì§ì ‘ì ìœ¼ë¡œ networkì˜ íë¦„ì„ ì œì–´í•˜ëŠ” ë‹¨ê³„ë¡œ, routingê³¼ ê°™ì€ ì œì–´ë¥¼ ìˆ˜í–‰í•œë‹¤.\n\n### Drivers\n\nì¦‰, libnetworkê°€ ì „ì²´ì ì¸ networkì˜ control planeê³¼ management plane ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ì˜€ë‹¤ë©´, driverëŠ” data planeì„ êµ¬í˜„í•œë‹¤. ì¦‰, ì§ì ‘ì ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰í•œë‹¤. ì´ëŸ¬í•œ ê¸°ëŠ¥ë“¤ì€ dockerì—ì„œ ì—¬ëŸ¬ ê°œì˜ driverë¼ëŠ” submoduleì„ í†µí•´ì„œ êµ¬í˜„í•˜ì˜€ë‹¤. docker pubë¥¼ í†µí•´ì„œ defaultë³´ë‹¤ ë‚˜ì•„ê°„ driver ì—­ì‹œ ì„¤ì¹˜ê°€ ê°€ëŠ¥í•˜ë‹¤. í•˜ì§€ë§Œ ê¸°ë³¸ì ìœ¼ë¡œ, host, bridge, overlay, ipvlan, macvlan ë“±ì„ í¬í•¨í•˜ê³  ìˆë‹¤.\n\nì—¬ê¸°ê¹Œì§€ê°€ docker networkì— ëŒ€í•œ overviewì´ë‹¤. ë‹¤ìŒ ì°¨ì‹œì— ê³„ì†...\n\n## Reference\n\n- [ğŸ”— Docker Deep Dive](https://www.oreilly.com/library/view/docker-deep-dive/9781800565135/), Nigel Poulton\n- Tumbnail : Photo by [Michael](https://unsplash.com/@michael75?utm_source=unsplash\u0026utm_medium=referral\u0026utm_content=creditCopyText) on [Unsplash](https://unsplash.com/s/photos/cargo-ships?utm_source=unsplash\u0026utm_medium=referral\u0026utm_content=creditCopyText)\n","slug":"docker-network-1","date":"2021-07-10 21:21","title":"[Docker] Network(1)","category":"Tech","tags":["Docker","Container","Network"],"desc":"Docker Swarmì„ docker stackì„ ì´ìš©í•˜ì—¬ ì‹¤í–‰ì‹œí‚¤ê²Œ ëœë‹¤ë©´, ë¬´ì—‡ì´ ìƒì„±ë˜ëŠ”ê°€? ìš°ë¦¬ëŠ” ì„œë¹„ìŠ¤ê°€ ìƒì„±ë˜ê¸°ë„ ì „ì— networkê°€ ìƒì„±ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ê°€ ìˆë‹¤. containerì™€ containerê°„ ê·¸ë¦¬ê³ , hostë¥¼ í†µí•´ ì™¸ë¶€ internetí™˜ê²½ì— containerë¥¼ ì—°ê²° ì‹œí‚¤ëŠ” ëª¨ë“  ê³¼ì •ì„ ì•Œì•„ë³´ì.Dockerë¥¼ ì‚¬ìš©í•˜ë‹¤ë³´ë©´, hostì™€ í†µì‹ ì„ ìœ„í•´ ì™¸ë¶€ë¡œ portë¥¼ ì—´ì–´ì£¼ëŠ” ê²ƒê³¼ container ê°„ì˜ í†µì‹ ì„ í—·ê°ˆë ¤ í•˜ëŠ” ì‚¬ëŒë“¤ì´ ìƒê°ë³´ë‹¤ ë§ì€ ê²ƒ ê°™ë‹¤. ì‹¬ì§€ì–´ëŠ” containerê°„ í†µì‹ ì„ ìœ„í•´ì„œ localhostë¡œ ì •ë³´ë¥¼ ì£¼ê³ ë°›ì„ë ¤ê³  í•˜ëŠ” ëª¹ì“¸ ì‹œë„ë¥¼ í•˜ëŠ” ê´€ê²½ë„ ëª‡ëª‡ ë´ì™”ë‹¤.ë”°ë¼ì„œ, ìš°ë¦¬ëŠ” í•œ ë²ˆ Dockerì˜ networkì— ëŒ€í•´ì„œ í•œ ë²ˆ ê³µë¶€í•´ë³´ëŠ” ê²ƒì´ ì¢‹ì„ ê²ƒì´ë‹¤.í•´ë‹¹ ì°¨ì‹œì—ì„œëŠ” ìš°ì„  ì „ì²´ì ì¸ docker networkë¥¼ ì„¤ëª…í•˜ëŠ” ê¸°ë³¸ì ì¸ í‚¤ì›Œë“œë¥¼ ì•Œì•„ë³¼ ê²ƒì´ê³ ,2 ì°¨ì‹œì—ì„œëŠ” ì£¼ë¡œ ì‚¬ìš©ë˜ëŠ” docker network driverë¥¼ ì•Œì•„ë³¼ ê²ƒì´ê³ ,3 ì°¨ì‹œì—ì„œëŠ” libnetworkì˜ í•µì‹¬ ê¸°ëŠ¥ ì¤‘ service discovery, load balancingì— ëŒ€í•´ì„œ ì•Œì•„ë³´ê² ë‹¤.","thumbnailSrc":"https://euidong.github.io/images/docker-picture.jpg"},"relatedPosts":[{"content":"\n## Intro\n\ndockerì— ê¸°ë³¸ ì´ë…ì€ í•˜ë‚˜ì˜ containerì—ëŠ” í•˜ë‚˜ì˜ processë§Œ ë‘ì–´ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤. í•˜ì§€ë§Œ, ì´ì— ëŒ€í•´ì„œ ë°˜ëŒ€ë¥¼ í•˜ê³ , í•˜ë‚˜ì˜ containerì— ì—¬ëŸ¬ ê°œì˜ processë¥¼ ì‹¬ê³  ì´ë¥¼ ì´ìš©í•˜ê² ë‹¤ëŠ” ìƒê°ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ open sourceì´ë‹¤. ì‚¬ìš© ì˜ˆì‹œëŠ” main process ë‚´ë¶€ì— cronjobì„ ë¼ì›Œë„£ëŠ” ê²ƒê³¼ ê°™ì€ ê²½ìš°ê°€ ìˆì„ ê²ƒì´ë‹¤.\n\nì´ëŠ” ê²°ë¡ ì ìœ¼ë¡œ Dockerfileì˜ í™•ì¥ ë²„ì „ì´ë¼ê³  ë³¼ ìˆ˜ë„ ìˆì„ ê±° ê°™ë‹¤. ì¢€ ë” ë³µì¡í•œ ì‘ì—…ì„ ë” ì²´ê³„ì ìœ¼ë¡œ í•  ìˆ˜ ìˆëŠ” í‹€ì„ ì œê³µí•œë‹¤. ì•„ì´ë””ì–´ ìì²´ëŠ” ì°¸ì‹ í•˜ë‚˜ ë‚¨ë°œí•˜ê²Œ ë˜ë©´, statelessí•˜ë˜ containerê°€ ì ì  statefulí•˜ê²Œ ë˜ë©´ì„œ ì‹œìŠ¤í…œì´ ì˜¤ì—¼ë  ìˆ˜ë„ ìˆìŒì„ ìœ ì˜í•˜ì.\n\nì•„ë˜ ë‚´ìš©ì€ í•´ë‹¹ opensourceì˜ READMEë¥¼ ì§ì ‘ ë²ˆì—­í•œ ë‚´ìš©ì´ë‹ˆ ì˜ì—­ë„ ë§ì´ í¬í•¨ëœë‹¤. ì£¼ì˜í•´ì„œ ì½ë„ë¡ í•˜ì. ë˜í•œ, ëª¨ë¥´ëŠ” ìš©ì–´ëŠ” ì•„ë˜ Terminologyë¥¼ í™•ì¸í•´ë³´ë„ë¡ í•˜ì.\n\n## Goals\n\n- ì´ë¯¸ì§€ ì œì‘ìê°€ ì‰½ê²Œ s6(s6ëŠ” processë¥¼ ê°ë…, ê´€ë¦¬, logging, ì´ˆê¸°í™”í•˜ëŠ” ê¸°ëŠ¥ë“¤ì˜ ì§‘í•©)ë¥¼ í™œìš©í•  ìˆ˜ ìˆë„ë¡ ì§€ì›\n- ë‹¤ë¥¸ docker imageë“¤ì²˜ëŸ¼ ë™ì¼í•˜ê²Œ ì‘ë™\n\n## Features\n\n- cont-init.d â†’ì´ˆê¸°í™” ì‘ì—…ê³¼ ê°™ì€ end-user ì‹¤í–‰ ì‘ì—…ì„ í—ˆìš©í•˜ëŠ” ê°„ë‹¨í•œ ì´ˆê¸° ì‘ì—…\n- cont-finish.d â†’ ë§ˆë¬´ë¦¬ ì‘ì—…\n- fix-attrs.d â†’ ownership ê¶Œí•œì„ ìˆ˜ì •\n- s6-overlayëŠ” ì ë‹¹í•œ PID 1 ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.\n  - containerì— ê±¸ë¦¬ëŠ” zombie processë¥¼ ê°€ì§€ì§€ ì•Šê³ , ì ë‹¹í•œ ì ˆì°¨ì— ë”°ë¼ ì œê±°ë  ê²ƒì´ë‹¤.\n- **ì—¬ëŸ¬ ê°œì˜ processë¥¼ í•˜ë‚˜ì˜ containerì—ì„œ ì‘ë™ì‹œí‚¤ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.**\n- **\"The Docker Way\"(ì•„ë˜ì—ì„œ ì„¤ëª…)ì— ë”°ë¼ ì‘ë™ì‹œí‚¤ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.**\n- ëª¨ë“  ê¸°ë°˜ ì´ë¯¸ì§€(Ubuntu, CentOS, Fedora, ì‹¬ì§€ì–´ëŠ” Busybox)ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.\n- ì´ë¯¸ì§€ì˜ layerì˜ ìˆ˜ë¥¼ ì‘ê²Œ ìœ ì§€í•˜ê¸° ìœ„í•˜ì—¬ í•˜ë‚˜ì˜ tar, gz íŒŒì¼ë¡œ ë°°í¬í•œë‹¤.\n- s6Â ì™€Â s6-portable-utils ëŠ” ì†ì‰½ê³  ì‘ì„±ì´ ì‰¬ìš´ ìœ í‹¸ë¦¬í‹° ì „ì²´ë¥¼ í¬í•¨í•œë‹¤.\n- ë¹„ë°€ë¦¬ì— s6-log ë¥¼ ì‚¬ìš©í•˜ëŠ” logutil-serviceëŠ” ì˜¤ë˜ëœ ë¡œê·¸ì˜ ìˆœí™˜ì„ ìˆ˜í–‰í•œë‹¤.\n- íŠ¹ì • ìœ ì €ë¡œ ì „ì²´ process treeë¥¼ ë™ì‘ì‹œí‚¤ê¸° ìœ„í•˜ì—¬, Dockerì˜ USER ì§€ì¹¨ì— ëŒ€í•˜ì—¬ ì§€ì›í•œë‹¤. ëª¨ë“  featureì— ëŒ€í•˜ì—¬ ì§€ì›í•˜ëŠ” ê²ƒì€ ì•„ë‹ˆë¼ëŠ” ê²ƒì„ ì•Œì•„ë‘ì–´ì•¼ í•œë‹¤. ìì„¸í•œ ì‚¬í•­ì€ ì—¬ê¸°ì„œ í™•ì¸ê°€ëŠ¥í•˜ë‹¤.([ğŸ”— notes](https://github.com/just-containers/s6-overlay#notes))\n\n## The Docker Way\n\nìì£¼ ê°•ì¡°ë˜ì–´ì§€ëŠ” Dockerì˜ ì‹ ë…ì€ \"í•˜ë‚˜ì˜ containerì— í•˜ë‚˜ì˜ processë§Œ ë‘ì–´ì•¼ í•œë‹¤.\"ëŠ” ê²ƒì´ë‹¤. ê·¸ëŸ¬ë‚˜, S6 overlay íŒ€ì€ ì´ì— ëŒ€í•˜ì—¬ ë™ì˜í•˜ì§€ ì•ŠëŠ”ë‹¤. í•˜ë‚˜ì˜ containerì— ì—¬ëŸ¬ processë¥¼ ë™ì‘ì‹œí‚¤ëŠ” ê²ƒì— ëŒ€í•œ ë³¸ì§ˆì  ë¬¸ì œëŠ” ì—†ë‹¤. ë” ì¶”ìƒì ìœ¼ë¡œ \"í•˜ë‚˜ì˜ containerì— í•˜ë‚˜ì˜ thingë§Œ ë‘ì–´ì•¼ í•œë‹¤.\"ëŠ” ê²ƒì´ í•´ë‹¹ í”„ë¡œì íŠ¸ì˜ ëª©ì ì´ë‹¤. â†’ í•˜ë‚˜ì˜ containerëŠ” í•˜ë‚˜ì˜ ê²ƒë§Œ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤. ì˜ˆë¡œì¨, chatting service ë˜ëŠ” gitlabì˜ ë™ì‘ì„ ë“¤ ìˆ˜ ìˆë‹¤. ì´ê²ƒë“¤ì€ ì—¬ëŸ¬ ê°œì˜ processë¥¼ í¬í•¨í•˜ì§€ë§Œ, í•˜ë‚˜ì˜ thingì´ë‹¤. ë”°ë¼ì„œ, ì˜¬ë°”ë¥´ë‹¤ëŠ” ê²ƒì´ë‹¤.\n\nì´ë¯¸ì§€ ì œì‘ìê°€ process supervisorë¥¼ í”¼í•˜ëŠ” ì´ìœ ëŠ” í•˜ë‚˜ì˜ process supervisorê°€ ì‹¤íŒ¨í•œ ì„œë¹„ìŠ¤ë¥¼ ë‹¤ì‹œ ì‹œì‘í•´ì•¼ í•œë‹¤ê³  ìƒê°í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ë¡œ ì¸í•´ì„œ ê²°êµ­ Docker containerëŠ” ì ˆëŒ€ ì£½ì§€ ì•Šì„ ê²ƒì´ë‹¤. ì´ëŸ¬í•œ containerê°€ ì£½ì§€ ì•ŠëŠ” í˜„ìƒì€ docker ìƒíƒœê³„ë¥¼ íŒŒê´´í•  ê²ƒì´ë‹¤. ëŒ€ë¶€ë¶„ì˜ ì´ë¯¸ì§€ëŠ” ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ë•Œ, ì¤‘ë‹¨ì„ ìš”ì²­í•˜ëŠ” í•˜ë‚˜ì˜ processë¥¼ ë™ì‘ì‹œí‚¨ë‹¤. ì—ëŸ¬ì— ëŒ€í•´ì„œ ì¢…ë£Œë¥¼ ìˆ˜í–‰í•¨ìœ¼ë¡œì¨, ì‹œìŠ¤í…œ ê´€ë¦¬ìëŠ” ì‹¤íŒ¨ë¥¼ ì›í•˜ëŠ”ëŒ€ë¡œ ë‹¤ë£¨ëŠ” ê²ƒì„ í—ˆë½ë°›ëŠ”ë‹¤. ë§Œì•½ ì´ë¯¸ì§€ë¥¼ ì ˆëŒ€ ì¢…ë£Œì‹œí‚¤ì§€ ì•ŠëŠ”ë‹¤ë©´, ì—ëŸ¬ íšŒë³µê³¼ ì‹¤íŒ¨ ì•Œë¦¼ì— ëŒ€í•œ ëŒ€ì•ˆì±…ì´ í•„ìš”í•˜ë‹¤. ì¦‰, containerë¥¼ ì‹¤íŒ¨ì—ë„, ì¢…ë£Œí•˜ì§€ ì•ŠëŠ” ê²ƒì€ ë§¤ìš° ìœ„í—˜í•˜ë‹¤.\n\nS6 overlay íŒ€ì˜ ì •ì±…ì€ ë§Œì•½ thingì´ ì‹¤íŒ¨í•œë‹¤ë©´, ê·¸ë•Œ containerê°€ ë°˜ë“œì‹œ ì‹¤íŒ¨í–ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤. ìš°ë¦¬ëŠ” ì–´ë–¤ processë“¤ì„ ë‹¤ì‹œ ë™ì‘ì‹œí‚¬ ìˆ˜ ìˆì„ì§€ì™€ ì–´ë–¤ containerë¥¼ ëŒì–´ë‚´ë¦´ì§€ë¥¼ ê²°ì •í•œë‹¤. ì˜ˆë¥¼ ë“¤ì–´, cron ì´ë‚˜ syslogì—ì„œ ì‹¤íŒ¨ê°€ ë°œìƒí–ˆì„ ë•Œ, containerëŠ” ë¶€ì •ì  ì˜í–¥ ì—†ì´ ì´ê²ƒì„ ì¬ì‹œì‘í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•  ê²ƒì´ë‹¤. ê·¸ëŸ¬ë‚˜ ë§Œì•½, ejabberd ê°€ ì‹¤íŒ¨í–ˆì„ ê²½ìš°ì—ëŠ” containerëŠ” ì¢…ë£Œë  ê²ƒì´ê³ , ì´ë¥¼ í†µí•´ì„œ ì‹œìŠ¤í…œ ê´€ë¦¬ìëŠ” ì´ì— ëŒ€í•œ ëŒ€ì±…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.\n\në”°ë¼ì„œ, S6 teamì—ì„œ ìƒê°í•˜ëŠ” \"The Docker Way\"ë€ ë‹¤ìŒê³¼ ê°™ë‹¤.\n\n- ContainerëŠ” ë°˜ë“œì‹œ í•˜ë‚˜ì˜ thingë§Œ ìˆ˜í–‰í•´ì•¼ í•œë‹¤.\n- ContainerëŠ” thingì´ ë©ˆì¶˜ë‹¤ë©´, ë°˜ë“œì‹œ ë©ˆì¶°ì•¼ í•œë‹¤.\n\nê·¸ë¦¬ê³ , ìš°ë¦¬ì˜ ì´ˆê¸° ì‹œìŠ¤í…œì€ ì´ë¥¼ ìœ„í•´ì„œ ì„¤ê³„ë˜ì—ˆë‹¤. ì´ë¯¸ì§€ëŠ” ì—¬ì „íˆ ë‹¤ë¥¸ Docker ì´ë¯¸ì§€ì²˜ëŸ¼ ë™ì‘í•  ê²ƒì´ê³ , ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë¯¸ì§€ë“¤ì˜ ìƒíƒœê³„ì™€ í•¨ê»˜ ì–´ìš°ëŸ¬ì§ˆ ê²ƒì´ë‹¤.\n\n---\n\n## Init stages\n\nS6 overlay initì€ containerí™”ëœ í™˜ê²½ì— ì ë‹¹í•˜ê²Œ ë™ì‘í•˜ê¸° ìœ„í•´ ì ë‹¹í•˜ê²Œ ë§ì¶¤í™”í•œ í”„ë¡œê·¸ë¨ì´ë‹¤. í•´ë‹¹ sectionì—ì„œëŠ” ì–´ë–»ê²Œ stageë“¤ì´ ë™ì‘í•˜ëŠ”ì§€ ê°„ë‹¨íˆ ì„¤ëª…í•œë‹¤. ë§Œì•½ ë” ìì„¸í•œ ì‚¬í•­ì´ ê¶ê¸ˆí•˜ë‹¤ë©´, ë‹¤ìŒ articleì„ ì½ê¸°ë¥¼ ì¶”ì²œí•œë‹¤. ([How to run s6-svscan as process 1](http://skarnet.org/software/s6/s6-svscan-1.html))\n\n- **stage 1 :** í•´ë‹¹ ë‹¨ê³„ì˜ ëª©ì ì€ ë‘ ë²ˆì§¸ ë‹¨ê³„ì— ì§„ì…í•˜ê¸° ìœ„í•´ì„œ ì´ë¯¸ì§€ë¥¼ ì¤€ë¹„í•˜ëŠ” ê²ƒì´ë‹¤. ë‹¤ë¥¸ ê²ƒë“¤ ì‚¬ì´ì—ì„œ, ì´ê²ƒì€ container í™˜ê²½ë³€ìˆ˜ë“¤ì„ ì¤€ë¹„í•˜ëŠ” ê²ƒê³¼ s6 ê°€ íš¨ê³¼ì ìœ¼ë¡œ ì‹œì‘ë  ë•Œê¹Œì§€ ë‘ ë²ˆì§¸ stageì˜ ì‹œì‘ì„ ë§‰ëŠ” ê²ƒì— ëŒ€í•œ ì±…ì„ì´ ìˆë‹¤.\n- **stage 2 :** end-userê°€ ì œê³µí•œ ëŒ€ë¶€ë¶„ì˜ íŒŒì¼ë“¤ì´ ìˆ˜í–‰ë˜ì–´ì§€ëŠ” ë‹¨ê³„ì´ë‹¤.\n  1. /etc/fix-attrs.dë¥¼ ì‚¬ìš©í•˜ì—¬, ì†Œìœ ê¶Œê³¼ ê¶Œí•œì„ ê³ ì •í•œë‹¤.\n  2. /etc/cont-init.dì— ê¸°ìˆ ëœ ì´ˆê¸°í™” scriptë¥¼ ì‹¤í–‰ì‹œí‚¨ë‹¤.\n  3. /etc/services.dì— ì íŒ user serviceë“¤ì„ s6ê°€ supervisionì„ ë™ì‘ ì¤‘ì¸ í´ë”ì— ë³µì‚¬í•˜ê³ , signalì„ ë³´ëƒ„ìœ¼ë¡œì¨ ì ì ˆí•˜ê²Œ supervisingì„ ì‹œì‘í•  ìˆ˜ ìˆë‹¤.\n- **stage 3 :** í•´ë‹¹ ë‹¨ê³„ëŠ” ì¢…ë£Œ ë‹¨ê³„ì´ë‹¤. ì´ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë™ì‘ì„ ìˆ˜í–‰í•œë‹¤.\n  1. TERM signalì„ ëª¨ë“  ê´€ë¦¬ ì¤‘ì¸ serviceì—ê²Œ ì „ì†¡í•œë‹¤.\n  2. /etc/cont-init.dì— í¬í•¨ëœ ì¢…ë£Œ scriptsë¥¼ ìˆ˜í–‰í•œë‹¤. ì´ëŠ” ì„œë¹„ìŠ¤ê°€ ì—¬ì „íˆ ì¢…ë£Œë˜ì–´ì§€ëŠ” ì¤‘ì—ë„ ì¢…ë£Œë˜ì–´ì§ˆ ìˆ˜ ìˆë‹¤.\n  3. ëª¨ë“  serviceê°€ ì¢…ë£Œë˜ê¸°ë¥¼ ê¸°ë‹¤ë¦°ë‹¤.(S6\\_SERVICES\\_GRACETIME millisecondsë¥¼ ë„˜ì§€ ì•ŠëŠ” ì„ ì—ì„œ - default 3000)\n  4. ëª¨ë“  processì—ê²Œ TERM signalì„ ë³´ë‚¸ë‹¤.\n  5. S6\\_KILL\\_GRACETIME milliseconds(default 3000)ë§Œí¼ sleepì„ ìˆ˜í–‰í•œë‹¤.\n  6. ëª¨ë“  processì—ê²Œ KILL signalì„ ì „ì†¡í•œë‹¤.\n\n## Usage\n\ní•´ë‹¹ projectëŠ” í‘œì¤€ tar, gzìœ¼ë¡œ ë°°í¬ë˜ì–´ì¡Œë‹¤. ì´ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” imageì˜ rootì— ì´ë¥¼ ì¶”ì¶œí•˜ê³ , ENTRYPOINTì— /init ì„ ê¸°ì…í•´ì£¼ë©´ ëœë‹¤. (ë§Œì•½, ê¸°ì¡´ ENTRYPOINTê°€ ìˆë‹¤ë©´, ì´ë¥¼ cont-initìœ¼ë¡œ ì˜®ê²¨ì£¼ì–´ì•¼ í•  ê²ƒì´ë‹¤. ë˜ëŠ” S6\\_CMD\\_ARG0ë¥¼ ì´ìš©í•˜ë©´ ëœë‹¤.)\n\nì—¬ê¸°ì„œ, í•´ë‹¹ projectëŠ” wget ë˜ëŠ” curlì„ ìˆ˜í–‰í•  ë•Œ, Dockerì˜ RUNë³´ë‹¤ ADD ì§€ì‹œì–´ë¥¼ ì‚¬ìš©í•  ê²ƒì„ ì¶”ì²œí•œë‹¤. (ì™œëƒí•˜ë©´, ì´ë¥¼ ì´ìš©í•˜ë©´, Dockerê°€ https URLì„ ë‹¤ë£° ìˆ˜ ìˆë‹¤.)\n\nì—¬ê¸°ì„œë¶€í„°, ì„œë¹„ìŠ¤ë¥¼ ì‘ì„±í•  ë•Œì—ëŠ” ë‘ ìŒì˜ ì„ íƒì§€ë¥¼ ê°–ê²Œ ëœë‹¤.\n\n\u003e **1. imageì˜ CMD ë¥¼ ì´ìš©í•˜ì—¬ service/programì„ ì‹¤í–‰ì‹œí‚¨ë‹¤.**\n\n```Dockerfile\nFROM busybox\nADD https://github.com/just-containers/s6-overlay/releases/download/v1.21.8.0/s6-overlay-amd64.tar.gz /tmp/\nRUN gunzip -c /tmp/s6-overlay-amd64.tar.gz | tar -xf - -C /\nENTRYPOINT [\"/init\"]\n```\n\n```bash\n# run\ndocker-host $ docker build -t s6demo .\ndocker-host $ docker run -ti s6demo /bin/sh\n[fix-attrs.d] applying owners \u0026 permissions fixes...\n[fix-attrs.d] 00-runscripts: applying... \n[fix-attrs.d] 00-runscripts: exited 0.\n[fix-attrs.d] done.\n[cont-init.d] executing container initialization scripts...\n[cont-init.d] done.\n[services.d] starting services\n[services.d] done.\n\n# ps\ndocker-host $ docker ps\nPID   USER     COMMAND\n    1 root     s6-svscan -t0 /var/run/s6/services\n    21 root     foreground  if   /etc/s6/init/init-stage2-redirfd   foreground    if     s6-echo     [fix-attrs.d] applying owners \u0026 permissions fixes.\n    22 root     s6-supervise s6-fdholderd\n    23 root     s6-supervise s6-svscan-log\n    24 nobody   s6-log -bp -- t /var/log/s6-uncaught-logs\n    28 root     foreground  s6-setsid  -gq  --  with-contenv  /bin/sh  import -u ? if  s6-echo  --  /bin/sh exited ${?}  foreground  s6-svscanctl  -t\n    73 root     /bin/sh\n    76 root     ps\n\n# exit\n/bin/sh exited 0\ndocker-host $\n```\n\n\u003e **2. s6-overlayë¥¼ í™œìš©í•˜ëŠ” ì‰¬ìš´ ë°©ë²•ì´ë¼ê³  í•  ìˆ˜ ìˆë‹¤.**\n\nDockerfileì´ buildí•  ë•Œ, ì‘ì„±í•˜ê±°ë‚˜ runtimeì— command lineìœ¼ë¡œ ì…ë ¥ì´ ê°€ëŠ¥í•˜ë‹¤. ì´ê²ƒì€ s6 supervisorì— ì˜í•´ì„œ ì‹¤í–‰ë˜ì–´ì§ˆ ê²ƒì´ë‹¤. ê·¸ë¦¬ê³  ì‹¤íŒ¨ë‚˜ ì¢…ë£Œ ì‹œì— í•´ë‹¹ containerëŠ” ì¢…ë£Œë˜ì–´ì§ˆ ê²ƒì´ë‹¤. interactive programë„ s6 supervisor í•˜ìœ„ì—ì„œë„ ë™ì‘ì‹œí‚¬ ìˆ˜ ìˆë‹¤. service scriptë¥¼ ì‘ì„±í•˜ì—¬ ì‹¤í–‰ì‹œí‚¨ë‹¤.\n\n`/etc/services.d/myapp/run`\n\n```shell\n  !/usr/bin/execlineb -P\n  nginx -g \"daemon off;\"\n```\n\nê´€ë¦¬ë˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì œì‘í•˜ëŠ” ê²ƒì€ ë‹¨ì§€ /etc/services.dì— service directoryë¥¼ ë§Œë“¤ê³ , ì¥ê¸°ê°„ ì¡´ì¬í•  process ì‹¤í–‰ì— ëŒ€í•œ ë‚´ìš©ì„ ì ì€ run íŒŒì¼ì„ ì´ ì•ˆì— ë§Œë“œëŠ” ê²ƒë³´ë‹¤ ë” ì‰¬ì›Œì§ˆ ìˆ˜ ì—†ë‹¤. ì´ê±°ë©´ ë‹¤ë‹¤. ë§Œì•½ s6 supervisionì— ëŒ€í•œ ë” ë§ì€ ë‚´ìš©ì„ ì•Œê¸°ë¥¼ ì›í•œë‹¤ë©´ ë‹¤ìŒ ë¬¸ì„œë¥¼ ì‚´í´ë³´ì•„ë¼. (\\[servicedir\\](\u003c[http://skarnet.org/software/s6/servicedir.html](http://skarnet.org/software/s6/servicedir.html)\\\u003e))\n\n## ì†Œìœ ê¶Œ ë° ê¶Œí•œ ê³ ì •\n\në•Œë•Œë¡œ, ì§„í–‰ ì „ì— ì†Œìœ ê¶Œê³¼ ê¶Œí•œì„ ê³ ì •í•˜ëŠ” ê²ƒì´ í•„ìš”í•  ë•Œê°€ ìˆë‹¤. ëŒ€í‘œì ì¸ ì˜ˆì‹œê°€ container ë‚´ë¶€ì— host folderì™€ mountëœ folderê°€ ìˆì„ ë•Œì´ë‹¤. overlayëŠ” /etc/fix-attrs.dì˜ íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ì´ë¥¼ í—¤ì³ë‚˜ê°ˆ ë°©ë²•ì„ ì œê³µí•œë‹¤.\n\n- Format\n  - path : File ë˜ëŠ” Directoryì˜ ê²½ë¡œ\n  - recurse : folderê°€ ë°œê²¬ë˜ì—ˆë‹¤ë©´, í•´ë‹¹ folder ë‚´ë¶€ì˜ ë‚´ìš©ë„ í¬í•¨í• ì§€ë¥¼ ê²°ì •í•©ë‹ˆë‹¤. (true or false)\n  - account : targetì˜ accountì´ë‹¤. accountë¥¼ ì°¾ì„ ìˆ˜ ì—†ì„ ê²½ìš° defaultë¡œ ì˜ˆë¹„ uid:gid(user id, group id)ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ë“¤ì–´, nobody, 32768:32768 ì´ë¼ê³  ì…ë ¥í•  ê²½ìš°, nobody accountë¥¼ ì²«ë²ˆì§¸ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ ì‹œë„ë¥¼ í•˜ê³ , ì˜ˆë¹„ë¡œ uidê°€ 32768ì¸ ëŒ€ìƒì„ ì˜ˆë¹„ë¡œ ì°¾ëŠ”ë‹¤. ì˜ˆë¥¼ë“¤ì–´, daemon ì˜ ê³„ì •ì´ UID=2ì´ê³ , GID=2ì¸ ê²½ìš° ë‹¤ìŒê³¼ ê°™ì€ account ë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.\n    - daemon: UID=2 GID=2\n    - daemon,3:4: UID=2 GID=2\n    - 2:2,3:4: UID=2 GID=2\n    - daemon:11111,3:4: UID=2 GID=11111\n    - 11111:daemon,3:4: UID=11111 GID=2\n    - daemon:daemon,3:4: UID=2 GID=2\n    - daemon:unexisting,3:4: UID=2 GID=4\n    - unexisting:daemon,3:4: UID=3 GID=2\n    - 11111:11111,3:4: UID=11111 GID=11111\n  - fmode : target fileì˜ mode â†’ example 0644\n  - dmode : target directoryì˜ mode â†’ example 0755\n- path recurse account fmode dmode\n\n\u003e **Example**\n\n`/etc/fix-attrs.d/01-mysql-data-dir`\n\n```shell\n/var/lib/mysql true mysql 0600 0700\n```\n\n`/etc/fix-attrs.d/02-mysql-log-dirs`\n\n```shell\n/var/log/mysql-error-logs true nobody,32768:32768 0644 2700\n/var/log/mysql-general-logs true nobody,32768:32768 0644 2700\n/var/log/mysql-slow-query-logs true nobody,32768:32768 0644 2700\n```\n\n## ì´ˆê¸°í™” ì‘ì—… ì‹¤í–‰í•˜ê¸°\n\n`/etc/fix-attrs.d`ì— ë”°ë¼ ì†ì„±ì„ ê³ ì •í•˜ëŠ” ì‘ì—…ì„ ìˆ˜í–‰í•œ í›„, `/etc/services.d`ì— ì íŒ userì—ê²Œ ì œê³µë˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ì‹œì‘í•˜ê¸° ì „ì—, overlayëŠ” /etc/cont-init.d ì—ì„œ ë°œê²¬ëœ ëª¨ë“  scriptë¥¼ ì‹¤í–‰ì‹œí‚¨ë‹¤.\n\n`/etc/cont-init.d/02-confd-onetime`\n\n```shell\n#!/usr/bin/execlineb -P\n\nwith-contenv\ns6-envuidgid nginx\nmultisubstitute\n{\n  import -u -D0 UID\n  import -u -D0 GID\n  import -u CONFD_PREFIX\n  define CONFD_CHECK_CMD \"/usr/sbin/nginx -t -c {{ .src }}\"\n}\nconfd --onetime --prefix=\"${CONFD_PREFIX}\" --tmpl-uid=\"${UID}\" --tmpl-gid=\"${GID}\" --tmpl-src=\"/etc/nginx/nginx.conf.tmpl\" --tmpl-dest=\"/etc/nginx/nginx.conf\" --tmpl-check-cmd=\"${CONFD_CHECK_CMD}\" etcd\n```\n\n## ë¶€ê°€ì ì¸ ì¢…ë£Œ ì‘ì—… ì‘ì„±í•˜ê¸°\n\nê¸°ë³¸ì ìœ¼ë¡œ, /etc/services.d ì— ì˜í•´ ìƒì„±ëœ ì„œë¹„ìŠ¤ëŠ” ìë™ì ìœ¼ë¡œ ì¬ì‹œì‘ëœë‹¤. ë§Œì•½, ì„œë¹„ìŠ¤ê°€ containerë¥¼ down ì‹œì¼œì•¼í•œë‹¤ë©´, finish scriptë¥¼ í†µí•´ì„œ ì´ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.\n\n`/etc/services.d/myapp/finish`\n\n```shell\n#!/usr/bin/execlineb -S0\n\ns6-svscanctl -t /var/run/s6/services\n```\n\në” ë°œì „ëœ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤.\n\n`/etc/services.d/myapp/finish`\n\n```shell\n#!/usr/bin/execlineb -S1\nif { s6-test ${1} -ne 0 }\nif { s6-test ${1} -ne 256 }\n\ns6-svscanctl -t /var/run/s6/services\n```\n\n## Logging\n\nS6 overlayëŠ” ì¦‰ì‹œ \\[s6-log\\](\u003c[http://skarnet.org/software/s6/s6-log.html](http://skarnet.org/software/s6/s6-log.html)\\\u003e)ë¥¼ í†µí•œ logging mechnismìœ¼ë¡œ ì‰½ê²Œ loggingì„ ê´€ë¦¬í•˜ëŠ” ë°©ë²•ì„ ì œê³µí•œë‹¤.\n\në˜í•œ, loggingì„ í•˜ë‚˜ì˜ ë°”ì´ë„ˆë¦¬ í˜¸ì¶œë¡œ ë§Œë“¤ ìˆ˜ ìˆë„ë¡ logutil-serviceë¼ëŠ” ë„ì›€ ì¥ì¹˜ë¥¼ ì œê³µí•œë‹¤.\n\nì´ëŠ” ë‹¤ìŒ ìˆœì„œì— ë”°ë¼ ì§„í–‰ëœë‹¤.\n\n- s6-logê°€ ì–´ë–»ê²Œ S6\\_LOGGING\\_SCRIPTì— ì íŒ logging scriptë¥¼ ì½ì„ì§€ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.\n- nobody userì˜ root ê¶Œí•œì„ ì‚­ì œí•œë‹¤.(ë§Œì•½, ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, ê¸°ë³¸ì ìœ¼ë¡œ 32768:32768 ì—ê²Œ ë„˜ê²¨ì§‘ë‹ˆë‹¤.)\n- ëª¨ë“  í™˜ê²½ ë³€ìˆ˜ë¥¼ ì§€ì›ë‹ˆë‹¤.\n- s6-logë¥¼ ì‹¤í–‰í•¨ìœ¼ë¡œì¨ loggingì„ ì‹œì‘í•©ë‹ˆë‹¤.\n\n\u003e **ì£¼ì˜ì‚¬í•­**\n\n- ê¶Œí•œì´ ìë™ì ìœ¼ë¡œ ì‚­ì œëœ ì´í›„ë¡œ, s6-setuidgidë¡œ userë¥¼ ë³€ê²½í•  í•„ìš”ê°€ ì—†ë‹¤.\n- ë‘˜ ì¤‘ í•˜ë‚˜ì˜ ë‚´ìš©ì„ log folderì—ì„œ ë³´ì¥í•´ì•¼ í•œë‹¤.\n  1. ì¡´ì¬í•œë‹¤ë©´, nobody userì— ì˜í•´ ì‘ì„±ì´ ê°€ëŠ¥í•´ì•¼ í•œë‹¤.\n  2. ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´, ìƒìœ„ í´ë”ê°€ nobody userì— ì˜í•´ ì‘ì„±ì´ ê°€ëŠ¥í•´ì•¼ í•œë‹¤.\n\nlog foderëŠ” cont-init.d scriptì—ì„œ ë˜ëŠ” run script ì•ˆì—ì„œ ìƒì„±í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.\n\n### Example\n\n\u003e **1. cont-inid.dë¥¼ í™œìš©í•œ ë°©ë²•**\n\n`/etc/cont-init.d/myapp-logfolder`\n\n```shell\n#!/bin/sh\nmkdir -p /var/log/myapp\nchown nobody:nogroup /var/log/myapp\n```\n\n\u003e **2.  run scriptë¥¼ í™œìš©í•œ ë°©ë²•**\n\n`/etc/services.d/myapp/log/run`\n\n```shell\n#!/bin/sh\n# input stdinì„ ê¸°ë°˜ìœ¼ë¡œ í•˜ëŠ” logging\nexec logutil-service /var/log/myapp\n\n#!/bin/sh\n# fifoì— ë”°ë¥¸ logë¥¼ ìŒ“ê¸°ë¥¼ ì›í•œë‹¤ë©´, ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜í–‰í•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•˜ë‹¤.\nexec logutil-service -f /var/run/myfifo /var/log/myapp\n```\n\n## ê¶Œí•œ ì‚­ì œ\n\nì„œë¹„ìŠ¤ ì‹¤í–‰ì´ ë‹¤ê°€ì˜¤ë©´, ì‹¤í–‰ ì „ì— ê¶Œí•œì„ ë¶€ì—¬í•˜ëŠ” ê²ƒì€ ì„œë¹„ìŠ¤ì´ê±´ logging ì„œë¹„ìŠ¤ì´ê±´ ë§¤ìš° ì¤‘ìš”í•œ ì‘ì—…ì´ë‹¤. s6ëŠ” ì´ë¯¸ ì´ëŸ¬í•œ ì‘ì—…ì„ ìœ„í•œ ê¸°ëŠ¥ì„ í¬í•¨í•˜ê³  ìˆë‹¤.\n\n\u003e **InÂ execline**\n\n```shell\n#!/usr/bin/execlineb -P\ns6-setuidgid daemon\nmyservice\n```\n\n\u003e **InÂ sh**\n\n```shell\n#!/bin/sh\nexec s6-setuidgid daemon myservice\n```\n\në§Œì•½ ì´ëŸ¬í•œ ê¸°ëŠ¥ì— ëŒ€í•˜ì—¬ ë” ì•Œê³  ì‹¶ë‹¤ë©´, ë‹¤ìŒ ë¬¸ì„œë“¤ì„ ì‚´í´ ë³´ì•„ë¼. [s6-setuidgid](http://skarnet.org/software/s6/s6-setuidgid.html),Â  [s6-envuidgid](http://skarnet.org/software/s6/s6-envuidgid.html), [s6-applyuidgid](http://skarnet.org/software/s6/s6-applyuidgid.html)\n\n## Container í™˜ê²½\n\në§Œì•½ container í™˜ê²½ì„ ì œê³µí•˜ê¸° ìœ„í•´ì„œ ì§ì ‘ ë§Œë“  scriptë¥¼ ì›í•œë‹¤ë©´, with-contenvë¥¼ í†µí•´ì„œ ì´ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.\n\n\u003e **/etc/cont-init.d/01-contenv-example**\n\n```shell\n#!/usr/bin/with-contenv sh\necho $MYENV\n```\n\n## Read-Only Root íŒŒì¼ ì‹œìŠ¤í…œ\n\nìµœê·¼ dokcerì˜ ë²„ì „ì—ì„œ read-only íŒŒì¼ ì‹œìŠ¤í…œìœ¼ë¡œ containerë¥¼ ë™ì‘ì‹œí‚¤ëŠ” ê²ƒì„ í—ˆìš©í•˜ì˜€ë‹¤. 2ë‹¨ê³„ ê³¼ì •ì—ì„œ, overlayëŠ” ì‚¬ìš©ìê°€ ì œê³µí•˜ëŠ” cont-init.d ì˜ ê¶Œí•œì„ ë³€ê²½í•˜ëŠ” ë¶€ê°€ì‘ì—…ì„ ìˆ˜í–‰í•œë‹¤. ë§Œì•½, root íŒŒì¼ ì‹œìŠ¤í…œì´ read-onlyë¼ë©´, S6\\_READ\\_ONLY\\_ROOT=1 ë¼ëŠ” ì„¤ì •ì„ í•´ì£¼ì–´ stage 2ì—ì„œ ì´ë¥¼ ì•Œ ìˆ˜ ìˆë„ë¡ í•´ì•¼ í•œë‹¤. ì´ë¥¼ í†µí•´ì„œ permissionì„ ë³€ê²½í•˜ê¸° ì´ì „ì—, /var/run/s6 ì— ì‚¬ìš©ìì˜ íŒŒì¼ì„ ë³µì‚¬í•˜ê²Œ ëœë‹¤.\n\nì´ëŠ” /var ê°€ ìˆ˜ì •ì´ ê°€ëŠ¥í•œ ê¶Œí•œì„ ê°–ê²Œëœë‹¤ëŠ” ê²ƒì´ê³ , ì´ëŠ” tmpfs ë¼ëŠ” íŒŒì¼ì‹œìŠ¤í…œì— ì˜í•´ì„œ ê°€ëŠ¥í•˜ë‹¤.\n\nâ†’ ë‹¤ìŒê³¼ ê°™ì´ ì‚¬ìš©í•˜ë©´, ìˆ˜í–‰ì´ ê°€ëŠ¥í•˜ë‹¤.\n\n```bash\n$ docker run -e S6_READ_ONLY_ROOT=1 --read-only --tmpfs /var:rw,exec [image name]\n```\n\n\u003e **ì£¼ì˜ì‚¬í•­**\n\në§Œì•½ S6\\_READ\\_ONLY\\_ROOT=1 ë¥¼ ì‚¬ìš©í•  ë•Œ, fix-attrs.d,Â cont-init.d,Â cont-finish.d, services.dì˜ symbol linkë¥¼ ìœ ì˜í•´ì•¼ í•œë‹¤. s6ì˜ ì œí•œì‚¬í•­ ë•Œë¬¸ì—, ì• ì„  ë””ë ‰í† ë¦¬ê°€ /var/run/s6ì— ë³µì‚¬ë˜ë©° symbol linkê°€ ì‹¤í–‰ë˜ì–´ ì˜ˆê¸°ì¹˜ ì•Šì€ ì¤‘ë³µì´ ë°œìƒí•œë‹¤.\n\n### **s6 ë™ì‘ ì‚¬ìš©ìí™”**\n\ns6ì˜ ë™ì‘ì„ ì´ë¯¸ ì •ì˜ëœ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„¤ì •í•¨ìœ¼ë¡œì¨ ì‹¤í–‰ë‹¨ê³„ì—ì„œ ì¡°ì •í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.\n\n- S6\\_KEEP\\_ENVÂ (default = 0): ë§Œì•½ ì„¤ì •ì´ ë˜ë©´, í™˜ê²½ê³¼ ì „ì²´ ê´€ë¦¬ ê³¼ì •ì´ ë°”ë¼ë³´ëŠ” ì›ë³¸ í™˜ê²½ë³€ìˆ˜ëŠ” resetë˜ì§€ ì•ŠëŠ”ë‹¤. ì´ëŠ” with-contenvë¥¼ ë¬´ì˜ë¯¸í•˜ê²Œ ë°”ê¿”ë²„ë¦°ë‹¤.\n- S6\\_LOGGINGÂ (default = 0):\n  - **0**: ëª¨ë“  Outputì´ stdout/stderrë¡œ ì „ë‹¬ëœë‹¤.\n  - **1**: ë‚´ë¶€ì˜ catch-all loggerë¥¼ ì‚¬ìš©í•˜ì—¬, ì§€ì†ì ìœ¼ë¡œ ì´ê²ƒì— ì „ì†¡í•œë‹¤. ì´ëŠ” /var/log/s6-uncaught-logsì— ìœ„ì¹˜í•œë‹¤. ê·¸ë˜ë„ CMDì—ì„œëŠ” stdout/stderrë¥¼ í†µí•´ ì „ë‹¬í•œë‹¤.\n  - **2**: ë‚´ë¶€ì˜ catch-all loggerë¥¼ ì‚¬ìš©í•˜ì—¬, ì§€ì†ì ìœ¼ë¡œ ì´ê²ƒì— ì „ì†¡í•œë‹¤. ì´ ê³¼ì •ì— CMDë„ í¬í•¨ëœë‹¤. ë”°ë¼ì„œ, stdout/stderrë¡œ ì“°ì—¬ì§€ëŠ” ê²ƒì€ ì•„ë¬´ê²ƒë„ ì—†ë‹¤.\n- S6\\_BEHAVIOUR\\_IF\\_STAGE2\\_FAILSÂ (default = 0):\n  - **0**: script(fix-attrsÂ orÂ cont-init)ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí–ˆë”ë¼ë„ ì¡°ìš©í•˜ê²Œ ì§€ì†í•œë‹¤.\n  - **1**: ì—ëŸ¬ ë©”ì„¸ì§€ì— ëŒ€í•œ ê²½ê³ ë¥¼ ì œê³µí•œ í›„ì— ì§€ì†í•œë‹¤.\n  - **2**: ê´€ë¦¬ ì‹œìŠ¤í…œì— ì¢…ë£Œ signalì„ ì „ì†¡í•˜ë©´ì„œ ì¢…ë£Œí•œë‹¤.\n- S6\\_KILL\\_FINISH\\_MAXTIMEÂ (default = 5000): /etc/cont-finish.d ì˜ scriptê°€ ì¢…ë£Œ signalì„ ë°›ì„ ë•Œê¹Œì§€ ê°€ì§ˆ ìˆ˜ ìˆëŠ” ìµœëŒ€ ëŒ€ê¸° ì‹œê°„ì„ ì˜ë¯¸í•œë‹¤. ê° scriptê°€ ìˆ˜í–‰ë  ë•Œë§ˆë‹¤ ìˆ˜í–‰ëœë‹¤.\n- S6\\_SERVICES\\_GRACETIMEÂ (default = 3000): ì–¼ë§ˆë‚˜ s6 ê°€ ì„œë¹„ìŠ¤ê°€ TERM signalì„ ë³´ë‚¼ ë•Œê¹Œì§€ ê¸°ë‹¬ë¦´ì§€ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.\n- S6\\_KILL\\_GRACETIMEÂ (default = 3000): ì–¼ë§ˆë‚˜ s6 ê°€ zombieë¥¼ ê±°ë‘ëŠ”ë° ê¸°ë‹¤ë¦´ì§€ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ì‹œê°„ì´ ì§€ë‚˜ë©´ KILL signalì„ ì „ì†¡í•©ë‹ˆë‹¤.\n- S6\\_LOGGING\\_SCRIPTÂ (default = \"n20 s1000000 T\"): í•´ë‹¹ ë³€ìˆ˜ëŠ” ì–´ë–»ê²Œ ë¬´ì—‡ì„ loggingí• ì§€ë¥¼ ê²°ì •í•œë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ ISO8601ë¥¼ ëª¨ë“  lineì— ë§ë¶™ì´ê³ , 1mbì— ë„ë‹¬í•˜ê±°ë‚˜ 20ê°œ ì´ìƒì˜ íŒŒì¼ì´ ìƒì„±ë˜ë©´ rotationì„ ìˆ˜í–‰í•œë‹¤.\n- S6\\_CMD\\_ARG0Â (default = not set): í•´ë‹¹ í™˜ê²½ ë³€ìˆ˜ì˜ ê°’ì€ dockerì— ì˜í•´ ì „ë‹¬ëœ CMD ì¸ìì— ë§ë¶™ì—¬ì§„ë‹¤. ì¡´ì¬í•˜ëŠ” ì´ë¯¸ì§€ë¥¼ s6-overlayë¡œ ë³€ê²½í•  ë•Œ, ì´ì „ì— ì‚¬ìš©í–ˆë˜ ENTRYPOINTì˜ ê°’ì„ ì´ê³³ì— ì „ë‹¬í•¨ìœ¼ë¡œì¨ ì´ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.\n- S6\\_FIX\\_ATTRS\\_HIDDENÂ (default = 0): ì–´ë–»ê²Œ fix-attrs.d scriptê°€ íŒŒì¼ê³¼ directoryë¥¼ ì²˜ë¦¬í• ì§€ë¥¼ ì œì–´í•œë‹¤.\n  - **0**: ìˆ¨ê²¨ì§„ íŒŒì¼ê³¼ directoryë¥¼ ì œì™¸í•œë‹¤.\n  - **1**: ëª¨ë“  íŒŒì¼ê³¼ directoryë¥¼ í¬í•¨í•œë‹¤.\n- S6\\_CMD\\_WAIT\\_FOR\\_SERVICES\\_MAXTIMEÂ (default = 5000): CMD ì‹¤í–‰ì„ ì§€ì†í•˜ê¸° ì „ì— ê¸°ë‹¤ë¦¬ëŠ” ìµœëŒ€ ì‹œê°„ì„ ì˜ë¯¸í•œë‹¤.\n- S6\\_READ\\_ONLY\\_ROOTÂ (default = 0): read-only íŒŒì¼ ì‹œìŠ¤í…œì„ ì‚¬ìš©í•˜ëŠ” container ë‚´ë¶€ì—ì„œ ë™ì‘í•  ë•Œ, 1ë¡œ ì„¤ì •í•˜ì—¬ ì´ˆê¸°í™” scriptsë¥¼ ê¶Œí•œ ì„¤ì •ì´ì „ì— /etcì—ì„œ /var/run/s6/etc ë¡œ ë³µì‚¬í•˜ë„ë¡ í•˜ëŠ” ë°©ì‹ì´ë‹¤. ìì„¸í•œ ì‚¬í•­ì€ ë‹¤ìŒì„ ì°¸ì¡°([Read-Only Root Filesystem](https://github.com/just-containers/s6-overlay#read-only-root-filesystem))\n- S6\\_SYNC\\_DISKSÂ (default = 0): 1ë¡œ ì„¤ì •í•˜ì—¬ stage 3ì—ì„œ container ì¢…ë£Œ ì´ì „ì— file ì‹œìŠ¤í…œì˜ syncë¥¼ ë§ì¶”ì–´ì•¼ í•¨ì„ ì•Œë¦°ë‹¤.\n\n### **Terminology**\n\n- PID 1 : linux kernelì—ì„œ ì²«ë²ˆì§¸ë¡œ ì‹œì‘ë˜ì–´ì§„ processì—ê²Œ PID 1ì´ ë¶€ì—¬ëœë‹¤. PID 1ì€ ë‹¤ë¥¸ processë“¤ê³¼ëŠ” ë‹¬ë¦¬ ë‹¤ìŒê³¼ ê°™ì€ íŠ¹ì§•ì¼ ê°–ëŠ”ë‹¤.\n  - PID 1 processê°€ ì¢…ë£Œëœë‹¤ë©´, ëª¨ë“  ë‹¤ë¥¸ processëŠ” KILL signalë¡œ ì¢…ë£Œëœë‹¤.\n  - ìì‹ processë¥¼ ê°€ì§„ ì–´ë–¤ processë¼ë„ ë¬´ìŠ¨ ì´ìœ ì—ì„œê±´ ì£½ëŠ”ë‹¤ë©´, ìì‹ë“¤ì€ PID 1 processì˜ ìì‹ìœ¼ë¡œ ë‹¤ì‹œ íƒœì–´ë‚œë‹¤.\n- Zombie process : ì‹¤í–‰ì´ ì¢…ë£Œë˜ì—ˆì§€ë§Œ, ì•„ì§ ì‚­ì œë˜ì§€ ì•Šì€ processë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ì´ë¥¼ ì‹¤ì œë¡œ ìœ ì§€í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì¸ë°, ê·¸ ì´ìœ ëŠ” ë¶€ëª¨ processê°€ ìì‹ processì˜ ì¢…ë£Œ ìƒíƒœë¥¼ íŒŒì•…í•˜ê¸° ìœ„í•´ì„œì´ë‹¤. ì´ëŸ¬í•œ ë°ì´í„°ëŠ” ì‹¤í–‰í•œ ëª…ë ¹ì˜ ê²°ê³¼ì— ë”°ë¼ì„œ ë¶„ê¸°ë¥¼ í•˜ê³  ì‹¶ì„ ë•Œ, ì¢…ë£Œ ê°’ì€ ìœ ìš©í•˜ê²Œ ì‚¬ìš©ëœë‹¤. ì´ë ‡ê²Œ zombie ìƒíƒœë¡œ ì§„ì…í•œ processëŠ” ë¶€ëª¨ processê°€ ì¢…ë£Œë˜ê±°ë‚˜ wait() ê³„ì—´ì˜ í•¨ìˆ˜ë¥¼ ì´ìš©í•´ì„œ processê°€ ì •ë¦¬ë  ëŒ€ê¹Œì§€ ë‚¨ì•„ìˆê²Œ ëœë‹¤. ë§Œì•½, ì´ëŸ¬í•œ zombie processê°€ ë‹¤ìˆ˜ ë‚¨ì•„ ìˆê²Œ ëœë‹¤ë©´ ì‹œìŠ¤í…œì—ë„ ì•…ì˜í–¥ì„ ë¯¸ì¹  ìˆ˜ ìˆë‹¤.\n- process supervisor : ì—¬ëŸ¬ processë¥¼ ëª¨ë‹ˆí„°ë§í•˜ê³ , ì œì–´í•˜ëŠ” programì„ ì˜ë¯¸í•œë‹¤.\n- ejabberd : Robust, Scalable and Extensible Realtime PlatformXMPP Server + MQTT Broker + SIP Service\n- symbol link : soft linkë¼ê³  ë¶ˆë¦¬ê¸°ë„ í•˜ë©°, ë‹¤ë¥¸ íŒŒì¼ì„ ê°€ë¥´í‚¤ëŠ” íŠ¹ë³„í•œ íŒŒì¼ë¡œ ì—¬ê¸¸ ìˆ˜ ìˆë‹¤. target íŒŒì¼ì˜ ë°ì´í„°ë¥¼ í¬í•¨í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ë‹¨ìˆœíˆ íŒŒì¼ ì‹œìŠ¤í…œì˜ ë‹¤ë¥¸ íŒŒì¼ì„ ê°€ë¥´í‚¤ê³ , ì´ë¥¼ í†µí•´ ì‹¤í–‰í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•œ ë°©ë²•ì´ë‹¤.\n- nobody user: ëŒ€ë‹¤ìˆ˜ì˜ Unix ì‹œìŠ¤í…œì—ì„œ, \"nobody\"ëŠ” ì „í†µì ìœ¼ë¡œ íŒŒì¼ì„ ê°€ì§€ì§€ ì•Šê³ , ì–´ëŠ ê¶Œí•œ ê·¸ë£¹ì—ë„ ì†í•˜ì§€ ì•Šìœ¼ë©°, ë‹¤ë¥¸ ëª¨ë“  ìœ ì €ë“¤ì´ ê°€ì§€ëŠ” ê¸°ëŠ¥ì„ ì œì™¸í•˜ë©´ ê¸°ëŠ¥ì´ ì—†ëŠ” ìœ ì €ë¥¼ ì˜ë¯¸í•œë‹¤.\n\n## ì¶œì²˜\n\n- [ğŸ”— just-containers/s6-overlay](https://github.com/just-containers/s6-overlay)\n","slug":"s6-overlay","date":"2021-07-11 12:13","title":"S6 Overlay","category":"Tech","tags":["Docker"],"desc":"dockerì— ê¸°ë³¸ ì´ë…ì€ í•˜ë‚˜ì˜ containerì—ëŠ” í•˜ë‚˜ì˜ processë§Œ ë‘ì–´ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤. í•˜ì§€ë§Œ, ì´ì— ëŒ€í•´ì„œ ë°˜ëŒ€ë¥¼ í•˜ê³ , í•˜ë‚˜ì˜ containerì— ì—¬ëŸ¬ ê°œì˜ processë¥¼ ì‹¬ê³  ì´ë¥¼ ì´ìš©í•˜ê² ë‹¤ëŠ” ìƒê°ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ open sourceì´ë‹¤. ì‚¬ìš© ì˜ˆì‹œëŠ” main process ë‚´ë¶€ì— cronjobì„ ë¼ì›Œë„£ëŠ” ê²ƒê³¼ ê°™ì€ ê²½ìš°ê°€ ìˆì„ ê²ƒì´ë‹¤.ì´ëŠ” ê²°ë¡ ì ìœ¼ë¡œ Dockerfileì˜ í™•ì¥ ë²„ì „ì´ë¼ê³  ë³¼ ìˆ˜ë„ ìˆì„ ê±° ê°™ë‹¤. ì¢€ ë” ë³µì¡í•œ ì‘ì—…ì„ ë” ì²´ê³„ì ìœ¼ë¡œ í•  ìˆ˜ ìˆëŠ” í‹€ì„ ì œê³µí•œë‹¤. ì•„ì´ë””ì–´ ìì²´ëŠ” ì°¸ì‹ í•˜ë‚˜ ë‚¨ë°œí•˜ê²Œ ë˜ë©´, statelessí•˜ë˜ containerê°€ ì ì  statefulí•˜ê²Œ ë˜ë©´ì„œ ì‹œìŠ¤í…œì´ ì˜¤ì—¼ë  ìˆ˜ë„ ìˆìŒì„ ìœ ì˜í•˜ì.ì•„ë˜ ë‚´ìš©ì€ í•´ë‹¹ opensourceì˜ READMEë¥¼ ì§ì ‘ ë²ˆì—­í•œ ë‚´ìš©ì´ë‹ˆ ì˜ì—­ë„ ë§ì´ í¬í•¨ëœë‹¤. ì£¼ì˜í•´ì„œ ì½ë„ë¡ í•˜ì. ë˜í•œ, ëª¨ë¥´ëŠ” ìš©ì–´ëŠ” ì•„ë˜ Terminologyë¥¼ í™•ì¸í•´ë³´ë„ë¡ í•˜ì.","thumbnailSrc":"https://euidong.github.io/images/docker-picture.jpg"},{"content":"\n## Intro\n\nì €ë²ˆ ê¸€ì— ì´ì–´ì„œ ì´ë²ˆì—ëŠ” docker networkì˜ driverë“¤ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì„ ë‹¤ë£¨ê² ë‹¤.\n\n- bridge networks\n- overlay networks\n- host networking\n- IPVlan networks\n- MacVlan networks\n\n## Bridge Network\n\ncontainerê°„ì˜ í†µì‹ ì„ ìœ„í•´ì„œ í•„ìš”í•œ ê²ƒì´ bridge ë„¤íŠ¸ì›Œí¬ì´ë‹¤. í•˜ì§€ë§Œ, ì—¬ê¸°ì„œ ì£¼ì˜í•´ì•¼í•  ê²ƒì€ ì˜¤ì§, single hostì—ì„œë§Œ ë™ì‘í•œë‹¤ëŠ” ì ì´ë‹¤. ì¦‰, ë‹¤ë¥¸ docker hostì— ì¡´ì¬í•˜ëŠ” containerì™€ëŠ” ì—°ê²°ì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤.\n\nê·¸ë ‡ë‹¤ë©´, bridgeê°€ ë¬´ì—‡ì¸ê°€? ì´ëŠ” ë‘ ê°œì˜ network ì¥ì¹˜ë¥¼ ì—°ê²°í•˜ëŠ” L2 switchë¥¼ ë§í•œë‹¤. ì¦‰, containerë¥¼ ì—°ê²°í•˜ëŠ” ë„êµ¬ë¼ê³  ë³´ë©´ ë˜ê² ë‹¤. ì´ë¥¼ í†µí•´ì„œ ì—°ê²°ëœ containerëŠ” í•´ë‹¹ containerì˜ ëª¨ë“  portì— ì ‘ê·¼ì´ ê°€ëŠ¥í•´ì§„ë‹¤.\n\n![docker-bridge-network](/images/docker-bridge-network.png)\n\nìœ„ëŠ” `$ docker network ls`ë¥¼ ì…ë ¥í•˜ë©´ ê¸°ë³¸ì ìœ¼ë¡œ ë³¼ ìˆ˜ ìˆëŠ” ë‚´ìš©ì´ë‹¤. ìœ„ì— ì„¸ê°œëŠ” ì²˜ìŒë¶€í„° ëê¹Œì§€ dockerì— ì¡´ì¬í•˜ëŠ” default networkì…ë‹ˆë‹¤. hostëŠ” ì§ì ‘ì ìœ¼ë¡œ hostì— ì—°ê²°í•˜ëŠ” ê²½ìš°ì˜ networkì´ê³ ,(í›„ì— ì„¤ëª…í•©ë‹ˆë‹¤.) noneì€ ì•„ë¬´ ë„¤íŠ¸ì›Œí¬ì—ë„ ì—°ê²°ë˜ì§€ ì•Šì•„ ì™¸ë¶€ë¡œ ì–´ë–¤ trafficë„ ë³´ë‚´ì§€ ì•Šì„ containerë“¤ì´ ì†í•˜ê²Œ ëœë‹¤. ì—¬ê¸°ì„œ bridgeëŠ” default bridgeë¼ê³  ë¶ˆë¦¬ë©°, networkë¥¼ ì„¤ì •í•˜ì§€ ì•Šê³ , containerë¥¼ ìƒì„±í•˜ê²Œ ë˜ë©´ ê¸°ë³¸ì ìœ¼ë¡œ í•´ë‹¹ bridgeë¡œ ì—°ê²°ë˜ê²Œ ëœë‹¤. ì´ë¥¼ í†µí•´ì„œ container ê°„ì˜ ì—°ê²°ë„ êµ¬í˜„í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.\n\ní•˜ì§€ë§Œ, ì¼ë°˜ì ìœ¼ë¡œ ë‹¨ì¼ ê¸°ê¸°ì—ì„œ container ê°„ì˜ ì—°ê²°ì„ ìˆ˜í–‰í•  ë•Œì—ëŠ” bridgeë¥¼ ì§ì ‘ ìƒì„±í•˜ì—¬ ì—°ê²°í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì´ë‹¤. (ê·¸ ì´ìœ ëŠ” ë„ë©”ì¸ ë„¤ì„ ì„¤ì •ì„ ìë™ìœ¼ë¡œ í•´ì¤€ë‹¤ëŠ” ì ì—ì„œ ì´ì ì´ ìˆê¸° ë•Œë¬¸ -\u003e [ğŸ”— ì°¸ê³ ](https://docs.docker.com/network/bridge/#differences-between-user-defined-bridges-and-the-default-bridge))\n\nì•„ë˜ëŠ” ì´ë¥¼ ì´ìš©í•œ ê°„ë‹¨í•œ ì˜ˆì‹œì´ë‹¤.\n\n```bash\n# bridge ìƒì„±\n$ docker network create -d bridge eui_bridge\n\n# container ìƒì„±\n$ docker container run -d --name c1 \\\n  -network eui_bridge \\\n  alpine sleep 1d\n  \n# container2 ìƒì„±\n$ docker container run -it --name c2 \\\n  -network eui_bridge \\\n  alpine sh\n   \n# pingì„ í†µí•´ c1ê³¼ ì—°ê²° ì—¬ë¶€ í™•ì¸\n$ ping c1\n```\n\nìœ„ì˜ ê³¼ì •ì„ ì²˜ìŒë¶€í„° ì„¤ëª…í•˜ìë©´,\n\n1. eui\\_bridgeë¼ëŠ” networkë¥¼ bridgeë¡œ ìƒì„±í•œë‹¤.\n2. containerì— eui\\_bridgeë¥¼ ì—°ê²°í•˜ê³ , alpine ì´ë¯¸ì§€ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìƒì„±í•œë‹¤. ì´ë•Œ ì‹œì‘ ì‹œì— sleepì„ í•˜ë£¨ ë™ì•ˆ ì‹œí–‰í•œë‹¤.(sleep í•˜ëŠ” ì´ìœ ëŠ” êº¼ì§€ì§€ ì•Šê²Œ í•˜ê¸° ìœ„í•¨)\n3. ë§ˆì°¬ê°€ì§€ë¡œ eui\\_bridgeì— ì—°ê²°í•˜ê³ , alpine ì´ë¯¸ì§€ë¡œ containerë¥¼ ìƒì„±í•œ í›„ì— shellì„ ì‹¤í–‰ì‹œí‚¨ë‹¤.\n4. c2ì—ì„œ ì‹¤í–‰ëœ shellì—ì„œ c1ìœ¼ë¡œ pingì„ ì „ì†¡í•œë‹¤. (ì´ë•Œ ê°™ì€ network bridgeë¼ë¦¬ëŠ” container nameìœ¼ë¡œ domainì´ ìƒì„±ëœë‹¤.)\n\nì°¸ê³ ë¡œ ì—¬ê¸°ì„œ ê¸°ì–µí•´ì•¼í•  ê²ƒì´ ìˆë‹¤ë©´, bridgeëŠ” containerê°„ì˜ ì—°ê²°ì„ ìœ„í•œ ê²ƒì´ê³ , containerì˜ íŠ¹ì • portë¥¼ hostì™€ mappingí•˜ê³ ì í•  ë•Œì—ëŠ”Â `--publish`Â ë¥¼ í™œìš©í•´ì•¼ í•œë‹¤.\n\n```bash\n$ docker run -p 5000:80 nginx\n```\n\nì´ë¥¼ í†µí•´ì„œ hostì˜ 5000ë²ˆê³¼ containerì˜ 80ë²ˆ portë¥¼ ì—°ê²°í•  ìˆ˜ ìˆë‹¤.\n\n## Overlay Network\n\nìœ„ì—ì„œ ì„¤ëª…í•œ ê²ƒì´ ë‹¨ì¼ í˜¸ìŠ¤íŠ¸ ë‚´ë¶€ì—ì„œ container ê°„ì˜ ì—°ê²°ì´ì—ˆë‹¤ë©´, ì—¬ëŸ¬ hostê°€ ì¡´ì¬í•˜ëŠ” cluster í™˜ê²½ì—ì„œ dockerì˜ containerê°„ í†µì‹ ì„ ìœ„í•œ driverê°€ overlayì´ë‹¤. í˜„ì¬ì—ëŠ” docker swarmì„ í†µí•´ì„œ applicationì„ ì—¬ëŸ¬ hostì—ì„œ ì œê³µí•˜ëŠ” ê²½ìš°ì— ì‚¬ìš©í•˜ê²Œ ëœë‹¤.\n\në¨¼ì € ì›ë¦¬ë¥¼ ì•Œì•„ë³´ìë©´, VXLANì„ í™œìš©í•œë‹¤ëŠ” ê²ƒì´ë‹¤. ì´ëŠ” L3 network ìƒìœ„ì—ì„œ ë‹¤ë¥¸ ë‘ ê¸°ê¸° ê°„ì— L2 í†µì‹ ì„ ì§€ì›í•˜ëŠ” ê²ƒì¸ë°, ì´ë¥¼ í†µí•´ì„œ ìš°ë¦¬ëŠ” ë‹¤ë¥¸ nodeê°„ì— ì¡´ì¬í•˜ëŠ” container ë¼ë¦¬ë„ í†µì‹ í•  ìˆ˜ ìˆë„ë¡ í•  ìˆ˜ ìˆë‹¤. docker swarmì— ì˜í•´ì„œ ê´€ë¦¬ë˜ì–´ L3ë¡œ ì—°ê²°ëœ ë‘ nodeì˜ ìœ„ì—ì„œëŠ” VXLAN Tunnel EndPoint(VTEP)ì´ ê° ê° ì¡´ì¬í•œë‹¤. ì´ë“¤ì„ í†µí•´ì„œ, tunnelì´ í˜•ì„±ë˜ê³  í†µì‹ ì´ ê°€ëŠ¥í•´ì§€ëŠ”ë°, ê¸°ì¡´ì— containerì— ì¡´ì¬í•˜ê³  ìˆë˜ CNMì—ì„œ ì •ì˜í•œ Sandbox ì†ì— virtual switchê°€ ìƒì„±ë˜ê³  ì´ì™€ VTEPì´ ì—°ê²°ë˜ì–´ ë‹¤ë¥¸ ê¸°ê¸°ì— ìˆëŠ” containerê°„ì—ë„ í†µì‹ ì´ ê°€ëŠ¥í•´ì§€ëŠ” ê²ƒì´ë‹¤.\n\nì˜ˆì‹œë¥¼ ë“ ë‹¤ë©´, docker stackì„ í†µí•´ì„œ ì‹œìŠ¤í…œì„ êµ¬ì„±í•´ë³¸ ì ì´ ìˆë‹¤ë©´, containerë¥¼ ìƒì„±í•˜ëŠ” ê³¼ì •ì—ì„œ networkê°€ ë¨¼ì € ìƒì„±ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤. ì´ë•Œ ìƒì„±ë˜ëŠ” ê²ƒì´ overlay ë„¤íŠ¸ì›Œí¬ë¡œ ì´ë¥¼ í†µí•´ì„œ ì—¬ëŸ¬ containerê°€ replicaê°€ ì–´ëŠ nodeì— ìƒê¸¸ì§€ í™•ì •í•  ìˆ˜ ì—†ìŒì—ë„ í†µì‹ ì„ ììœ ë¡­ê²Œ í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.\n\n## Host Networking\n\ní•´ë‹¹ ë°©ì‹ì€ dockerë¥¼ í•œ ë²ˆì´ë¼ë„ ì¨ë³¸ ì‚¬ëŒì´ë¼ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ëŠ” ìµìˆ™í•  ê²ƒì´ë‹¤.\n\n```bash\n$ docker run -p 80:80 nginx\n```\n\nnginx imageë¥¼ ê¸°ë°˜ìœ¼ë¡œ containerë¥¼ ì‹¤í–‰ì‹œí‚¤ê³ , container ë‚´ë¶€ì˜ 80ë²ˆê³¼ hostì˜ 80ë²ˆ portë¥¼ mappingí•˜ê² ë‹¤ëŠ” ê²ƒì´ë‹¤. ì´ë¥¼ í†µí•´ì„œ containerëŠ” hostì˜ networkì— ê´€ì—¬í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.\n\ní•˜ì§€ë§Œ, host networkingì„ ì´ìš©í•˜ê²Œ ë˜ë©´ container ë‚´ë¶€ì— network stackì´ ìƒì„±ë˜ì§€ ì•Šê³ , í•´ë‹¹ containerì˜ ëª¨ë“  network ì„¤ì •ì´ í•´ë‹¹ hostì˜ ì„¤ì •ì— ê·¸ëŒ€ë¡œ mappingë˜ëŠ” ê²ƒì´ë‹¤. ì´ë¥¼ ì´ìš©í•˜ë©´ ì„±ëŠ¥ìƒì˜ ì´ì ì€ ìˆê² ì§€ë§Œ, ìƒë‹¹íˆ ì„¤ì •ì´ ë‚œì¡í•´ì§ˆ ìˆ˜ ìˆë‹¤.\n\n## IPVlan Network\n\nMAC addressì™€ IP adressë¥¼ ë¶€ì—¬í•˜ì—¬, ì‹¤ì œ ë„¤íŠ¸ì›Œí¬ì— containerë¥¼ ì§ì ‘ ì—°ê²°í•˜ëŠ” ë°©ì‹ì´ë‹¤.\n\nì¥ì ì€ ë³„ë„ì˜ port forwardingì´ë‚˜ bridgeë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë‹¹ì—°íˆ ë¹ ë¥´ì§€ë§Œ, NICë¥¼ ì´ìš©í•˜ê¸°ì— promiscuous modeë¥¼ opení•´ì•¼ í•œë‹¤ëŠ” ë‹¨ì ì´ ìˆë‹¤. ì´ëŠ” switchê°€ ë°ì´í„°ë¥¼ ì „ì†¡í•  ëŒ€ìƒì„ ì°¾ì§€ ì•Šê³ , ì—°ê²°ëœ ëª¨ë“  ëŒ€ìƒì—ê²Œ ë³´ë‚´ëŠ” ëª¨ë“œë¡œ, sniffingì— ì·¨ì•½í•˜ê³  ì´ ë•Œë¬¸ì— public cloud systemì—ì„œëŠ” ì´ë¥¼ ë§‰ì•„ ë†“ê¸°ì— ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.\n\n![docker-ip-vlan](/images/docker-ip-vlan.png)\nì—¬ê¸°ê¹Œì§€ ë§í–ˆì„ ë•Œ, ì´í•´í–ˆë‹¤ë©´, ì´ë¯¸ ì„¤ì •í•˜ëŠ” ê²ƒì„ ì•Œì•„ë³´ëŸ¬ ë– ë‚˜ë©´ ë  ê²ƒì´ê³ , ì´í•´í•˜ì§€ ëª»í–ˆë‹¤ë©´, ì•„ë§ˆ ì“¸ ì¼ì´ ì—†ì„ ê²ƒì´ë‹ˆ ë„˜ì–´ê°€ì‹œë©´ ë  ê²ƒì´ë‹¤.\n\nìì„¸í•œ ì‚¬í•­ì€ ê³µì‹ í˜ì´ì§€ë¥¼ ì°¸ê³ í•˜ì.\n\n[ğŸ”— IPvlan networks](https://docs.docker.com/network/ipvlan/)\n\n## MacVlan Network\n\nipvlanê³¼ ë™ì¼í•˜ì§€ë§Œ ì°¨ì´ì ì€ MAC ì£¼ì†Œë¥¼ í• ë‹¹í•œë‹¤ëŠ” ì ì´ë‹¤. ê·¸ ì™¸ì—ëŠ” ë‹¤ë¥¼ ê²ƒì´ ì—†ë‹¤.\n\n[ğŸ”— macvlan networks](https://docs.docker.com/network/macvlan/)\n\n## Reference\n\n- [ğŸ”— Docker Deep Dive](https://www.oreilly.com/library/view/docker-deep-dive/9781800565135/), Nigel Poulton\n","slug":"docker-network-2","date":"2021-07-11 00:04","title":"[Docker] Network(2)","category":"Tech","tags":["Docker","Container","Network"],"desc":"ì €ë²ˆ ê¸€ì— ì´ì–´ì„œ ì´ë²ˆì—ëŠ” docker networkì˜ driverë“¤ì— ëŒ€í•œ ìì„¸í•œ ë‚´ìš©ì„ ë‹¤ë£¨ê² ë‹¤.- bridge networks- overlay networks- host networking- IPVlan networks- MacVlan networks","thumbnailSrc":"https://euidong.github.io/images/docker-picture.jpg"},{"content":"\n## Intro\n\nì—¬íƒœê¹Œì§€ dockerì˜ driverë¥¼ í†µí•œ networking ê¸°ìˆ ì„ ì•Œì•„ë³´ì•˜ê³ , ì´ì œ libnetworkë¡œ 1/3ì—ì„œ ì œì‹œí–ˆë˜ ê¸°ë³¸ routingê³¼ ê°™ì€ ê¸°ëŠ¥ ì™¸ì— êµ¬í˜„ë˜ì–´ ìˆëŠ” ê¸°ëŠ¥ë“¤ì— ëŒ€í•´ì„œ ì•Œì•„ë´…ë‹ˆë‹¤.\n\n- service discovery\n- load balancing\n\n## Service discovery\n\nëª¨ë“  containerë“¤ê³¼ swarmì˜ ì„œë¹„ìŠ¤ë“¤ì´ ì´ë¦„ì„ í†µí•´ì„œ ê° ê°ì„ ì°¾ì„ ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê²ƒì´ë‹¤. DockerëŠ” ìì²´ì ìœ¼ë¡œ ë‚´ë¶€ì˜ DNS ì„œë²„ë¥¼ ì´ìš©í•˜ì—¬ ì´ë¥¼ ìˆ˜í–‰í•œë‹¤. ê³¼ì •ì„ ìš”ì•½í•˜ìë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.\n\n1. containerê°€ ì´ë¦„ì„ í†µí•´ì„œ íŠ¹ì • containerë¥¼ ì°¾ì•„ì•¼ í•¨ì„ ì¸ì‹í•œë‹¤.\n2. ë¨¼ì € Local ë‚´ë¶€ì—ì„œ ì´ì— ëŒ€í•œ ì •ë³´ë¥¼ ê°–ê³  ìˆëŠ”ì§€ë¥¼ íƒìƒ‰í•œë‹¤. -\u003e ìˆë‹¤ë©´, ì¢…ë£Œ\n3. Docker DNS serverì— ì´ë¥¼ ìš”ì²­í•˜ëŠ” queryë¥¼ ì „ì†¡í•œë‹¤.\n4. Docker DNS serverëŠ” ëª¨ë“  containerì˜ nameê³¼ network alias(ë³„ì¹­)ë¥¼ ì•Œê¸° ë•Œë¬¸ì— ì´ë¥¼ ì°¾ì„ ìˆ˜ ìˆë‹¤.\n5. ì´ë•Œ, DNS serverëŠ” ë¨¼ì € ë™ì¼í•œ networkì— í•´ë‹¹ containerê°€ ì¡´ì¬í•˜ëŠ”ì§€ë¥¼ í™•ì¸í•œë‹¤. -\u003e ì—†ë‹¤ë©´, ì™¸ë¶€ DNS serverë¡œ\n6. ì¡´ì¬í•œë‹¤ë©´, ì´ë¥¼ ìš”ì²­ì„ ë³´ë‚¸ resolverì—ê²Œ ì „ë‹¬í•˜ê³ , ì´ê²Œ ë‹¤ì‹œ containerë¡œ ì „ë‹¬ëœë‹¤.\n\n## Load balancing\n\ndocker swarmì€ ê¸°ë³¸ì ì¸ load balancerë¥¼ ì§€ì›í•˜ì—¬, ì•„ë˜ ê·¸ë¦¼ê³¼ ê°™ì´ êµ¬í˜„ë˜ì–´ì§„ë‹¤.\n\n```bash\n$ docker service create \\\n  --name my-web \\\n  --publish published=8080,target=80 \\\n  --replicas 2 \\\n  nginx\n```\n\n![docker-ingress-network](/images/docker-ingress-network.png)\n\nì¦‰, ì–´ë””ë¡œ ìš”ì²­ì„ ë³´ë‚¸ë‹¤ê³ , í• ì§€ë¼ë„ load balancerëŠ” ì–´ë””ì— í•´ë‹¹ ì„œë¹„ìŠ¤ê°€ ì¡´ì¬í•˜ëŠ”ì§€ë¥¼ íŒŒì•…í•˜ê³ , ì´ë¥¼ ì „ë‹¬í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•´ì§„ë‹¤. ë”°ë¼ì„œ, ì–´ëŠ ë…¸ë“œë¡œ ìš”ì²­ì„ ë³´ë‚´ë”ë¼ë„ ì •ìƒì ìœ¼ë¡œ ìš”ì²­ì´ ì „ë‹¬ë  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤. ì´ë¥¼ Ingress load balancingì´ë¼ê³  ë¶€ë¥¸ë‹¤.\n\në§Œì•½, íŠ¹ì • nodeë¡œ ì „ë‹¬ëœ ìš”ì²­ì€ í•´ë‹¹ nodeì— ìˆëŠ” containerë¡œ ì „ë‹¬ë˜ê¸°ë¥¼ ë°”ë€ë‹¤ë©´, hostëª¨ë“œë¥¼ ì´ìš©í•˜ì—¬ ì§„í–‰í•  ìˆ˜ë„ ìˆë‹¤.\n\nì—¬ê¸°ê¹Œì§€ê°€ networkì— ëŒ€í•œ ì „ë°˜ì ì´ ë‚´ìš©ì…ë‹ˆë‹¤.\n\n## Reference\n\n- [ğŸ”— Docker Deep Dive](https://www.oreilly.com/library/view/docker-deep-dive/9781800565135/), Nigel Poulton\n","slug":"docker-network-3","date":"2021-07-11 00:40","title":"[Docker] Network(3)","category":"Tech","tags":["Docker","Container","Network"],"desc":"ì—¬íƒœê¹Œì§€ dockerì˜ driverë¥¼ í†µí•œ networking ê¸°ìˆ ì„ ì•Œì•„ë³´ì•˜ê³ , ì´ì œ libnetworkë¡œ 1/3ì—ì„œ ì œì‹œí–ˆë˜ ê¸°ë³¸ routingê³¼ ê°™ì€ ê¸°ëŠ¥ ì™¸ì— êµ¬í˜„ë˜ì–´ ìˆëŠ” ê¸°ëŠ¥ë“¤ì— ëŒ€í•´ì„œ ì•Œì•„ë´…ë‹ˆë‹¤.- service discovery- load balancing","thumbnailSrc":"https://euidong.github.io/images/docker-picture.jpg"},{"content":"\n## Intro\n\ní•´ë‹¹ ê¸€ì€ Linuxì—ì„œ dockerë¥¼ ë™ì‘ì‹œí‚¨ë‹¤ëŠ” ê°€ì •í•˜ì— ì‘ì„±í•˜ì˜€ë‹¤. (Windowë„ ëŒ€ë¶€ë¶„ ë™ì¼í•˜ë‹¤ê³  í•œë‹¤.)\n\ndockerëŠ” ì—¬ëŸ¬ ê°œì˜ ë³´ì•ˆ ì •ì±…ì„ í¬í•¨í•œë‹¤.\n\nì´ë¥¼ í¬ê²Œ ëˆ„ê°€ ê´€ë¦¬í•˜ëŠëƒì— ë”°ë¼ì„œ ë‘ ê°œì˜ ë¶€ë¥˜ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆë‹¤.\n\n1. OS system (Linux)\n2. Docker\n\nì´ì „ ê°€ìƒí™”ì™€ ë°˜ê°€ìƒí™”ë¥¼ ë¹„êµí•œ ê¸€ì—ì„œ ë³´ì•˜ë“¯ì´ Container ê¸°ìˆ ì„ ê²°ê³¼ì ìœ¼ë¡œ ë°˜ê°€ìƒí™”ì— í•´ë‹¹í•˜ë©°, ì´ë¥¼ ìœ„í•´ì„œ OSì˜ ì§€ì›ì´ í•„ìš”í•˜ë‹¤. ë”°ë¼ì„œ, ì´ë¥¼ Linux ìì²´ì—ì„œ êµ¬í˜„í•´ì£¼ëŠ” ê²ƒì´ ì¡´ì¬í•˜ê³ , Dockerì—ì„œ Application ë‹¨ì—ì„œ êµ¬í˜„í•œ ë¶€ë¶„ìœ¼ë¡œ ë‚˜ë‰˜ì–´ì§€ëŠ” ê²ƒì´ë‹¤.\n\në¨¼ì €, Linuxì—ì„œ ì§€ì›í•˜ëŠ” ê°ì¢… securityì— ëŒ€í•´ì„œ ì•Œì•„ë´…ì‹œë‹¤.\n\n## Linux's Security for Docker\n\nì „ì²´ì ì¸ ë””í…Œì¼ ì‚¬í•­ì€ ì •ë¦¬í•˜ì§€ ì•ŠëŠ”ë‹¤. í•´ë‹¹ ë‚´ìš©ì€ ê°„ë‹¨íˆ ì‚´í´ë³´ëŠ” ì •ë„ì´ë‹¤.\n\n### Namespaces\n\nnamespaceëŠ” container ê¸°ìˆ ì—ì„œ ë§¤ìš° í•µì‹¬ì ì¸ ìœ„ì¹˜ì— ì¡´ì¬í•œë‹¤ê³  í•  ìˆ˜ ìˆë‹¤. ì´ë¥¼ í†µí•´ì„œ, OSë¥¼ ì—¬ëŸ¬ ê°œë¡œ ë‚˜ëˆ„ê³ , ë§ˆì¹˜ ì™„ì „íˆ ê³ ë¦½ëœ í˜•íƒœì˜ OSì²˜ëŸ¼ ëŠë¼ë„ë¡ ë§Œë“ ë‹¤. (í‚¤ì›Œë“œëŠ” isolation) ê·¸ë ‡ë‹¤ë©´ í•˜ë‚˜ì˜ host ë‚´ì—ì„œ ì–´ë–»ê²Œ ì—¬ëŸ¬ ê°œì˜ containerê°€ ì™„ë²½í•˜ê²Œ ë…ë¦½ë˜ì–´ ìˆë‹¤ê³  ëŠë‚„ ìˆ˜ ìˆê²Œ í•  ìˆ˜ ìˆì„ê¹Œ? ì´ëŠ” ë‹¤ìŒê³¼ ê°™ì€ ì¢…ë¥˜ì˜ namespaceë¥¼ ë¶„ë¦¬í•¨ìœ¼ë¡œì„œ ê°€ëŠ¥í•˜ë‹¤.\n\n- **process ID (pid)** : processëŠ” tree í˜•íƒœë¡œ ì´ë£¨ì–´ì§€ê²Œ ëœë‹¤. ë”°ë¼ì„œ, í•˜ë‚˜ì˜ process (ì¦‰, PID 1)ì— ì˜í•´ì„œ ì—¬ëŸ¬ ê°œì˜ processê°€ ë™ì‘ì„ ì‹œì‘í•˜ëŠ” ê²ƒì´ë‹¤. ê·¸ëŸ°ë°, namespaceë¥¼ í†µí•´ì„œ ìš°ë¦¬ëŠ” ì—¬ëŸ¬ ê°œì˜ ì™„ë²½í•˜ê²Œ ë…ë¦½ì ì¸ process treeë¥¼ êµ¬ì¶•í•˜ê²Œ ëœë‹¤.\n- **Network (net)** :Â ê° ê°ì˜ containerë§ˆë‹¤ network stackì„ êµ¬í˜„í•œë‹¤. ì¦‰, network interface ë¶€í„° ì‹œì‘í•´ì„œ, IP Address, port, routing table ë“±ì„ êµ¬ì¶•í•˜ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.\n- **Filesystem / mount (mnt)** :ëª¨ë“  containerê°€ ê°ìì˜ root filesystemì„ ê°€ì§€ê³ , ë‹¤ë¥¸ ëª¨ë“  containerë“¤ì€ ì´ê²ƒì— ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤.\n- **Inter process Communication(ipc)** : processê°„ì˜ í†µì‹ ì„ ìœ„í•´ì„œ ìš°ë¦¬ëŠ” shared memoryë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ëŠ”ë° ì´ ë˜í•œ ê³ ë¦½ì ìœ¼ë¡œ êµ¬í˜„ë˜ë„ë¡ í•œë‹¤.\n- **User** : ê° containerë§ˆë‹¤ ë‹¤ë¥¸ user groupì„ êµ¬ì¶•í•˜ê³  ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.\n- **Unix Time sharing (uts)** : hostnameì„ containerë§ˆë‹¤ ì œê³µí•˜ëŠ” ê²ƒìœ¼ë¡œ, ì´ë¥¼ í†µí•´ì„œ network ìƒì—ì„œ ipê°€ ì•„ë‹Œ hostnameìœ¼ë¡œ ì ‘ê·¼í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•´ì§„ë‹¤.\n\nì¦‰, í•´ë‹¹ ì ˆì—ì„œëŠ” ì´ í•œ ë§ˆë””ë¥¼ ê¸°ì–µí•˜ë©´ í¸í•´ì§‘ë‹ˆë‹¤. \"í•˜ë‚˜ì˜ Dockerì˜ containerëŠ” namespaceë“¤ì˜ ì§‘í•©ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ìˆë‹¤.\"\n\n### Control Groups(C group)\n\nnamespaceê°€ ê° containerê°„ì˜ isolationì„ ë³´ì¥í•œë‹¤ë©´, cgroupì€ í•œê³„ë¥¼ ì„¤ì •í•˜ëŠ” ê²ƒì´ ì—­í• ì´ë‹¤. containerë“¤ì´ í•˜ë‚˜ì˜ machineì—ì„œ ë™ì‘í•œë‹¤ë©´ ì–´ì©” ìˆ˜ ì—†ì´ ê·¸ë“¤ì´ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì´ ìì›ì˜ ì–‘ì€ í•œì •ë  ìˆ˜ ë°–ì— ì—†ë‹¤. ê·¸ë¦¬ê³ , ìì¹« ì˜ëª»í•˜ë©´ í•˜ë‚˜ì˜ containerê°€ ë„ˆë¬´ ë§ì€ ìì›(CPU, Memory, Storage, ...)ì„ ì†Œëª¨í•˜ì—¬ ë‹¤ë¥¸ containerì˜ ë™ì‘ì„ ë°©í•´í•  ìˆ˜ ìˆë‹¤. ì´ë¥¼ ë§‰ê¸° ìœ„í•œ ê²ƒì´ ë°”ë¡œ cgroupì´ë‹¤. ì´ë¥¼ í†µí•´ì„œ ìš°ë¦¬ëŠ” ê° containerì—ê²Œ ìì›ì„ ë‚˜ëˆ„ì–´ í• ë‹¹í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.\n\n### Capabilities\n\nì–´ë–¤ ì‘ì—…ì„ í•˜ë”ë¼ë„, Machineì„ root ê¶Œí•œìœ¼ë¡œ ì‘ì—…ì„ í•˜ëŠ” ê²ƒì€ êµ‰ì¥íˆ ìœ„í—˜í•˜ë‹¤. ë”°ë¼ì„œ, containerì—ì„œ applicationì„ ë™ì‘ì‹œí‚¤ê¸° ìœ„í•œ ìµœì†Œí•œì˜ ê¶Œí•œë§Œì„ ë¶€ì—¬í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì˜¬ë°”ë¥´ë‹¤. ì´ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡, ê¶Œí•œì„ ì§€ì •í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.\n\n### Mandatory Access Control(MAC) system\n\nMACì€ íŒŒì¼ì´ë‚˜ íŠ¹ì • ë°ì´í„°ì— ëŒ€í•œ ì ‘ê·¼ ì œì–´ë¥¼ ìˆ˜í–‰í•˜ëŠ” ê²ƒì„ ì˜ë¯¸í•œë°, ì´ëŠ” AppArmorë‚˜ SELinux ë“±ì— ì˜í•´ì„œ êµ¬í˜„ë˜ì–´ì§€ëŠ”ë°, ê¸°ë³¸ì ìœ¼ë¡œ DockerëŠ” containerì— AppArmorë¥¼ ê° containerì— ì ìš©í•˜ì—¬ ì´ë¥¼ êµ¬í˜„í•œë‹¤. customizingì´ ê°€ëŠ¥í•˜ì§€ë§Œ, ì´ì— ëŒ€í•œ ì´í•´ë¥¼ ì¶©ë¶„íˆ í•˜ê¸°ë¥¼ ê¶Œí•œë‹¤.\n\n### seccomp\n\nseccompì˜ filter modeë¥¼ í™œìš©í•˜ë©´, containerì—ì„œ ë°œìƒí•˜ëŠ” syscallì„ ì œí•œí•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤. ì´ëŠ” MAC ì²˜ëŸ¼ ì§ì ‘ customizingë„ ê°€ëŠ¥í•˜ì§€ë§Œ ì´ì— ëŒ€í•œ ê¹Šì€ ì´í•´ê°€ ë’·ë°›ì¹¨ë˜ì–´ì•¼ í•œë‹¤.\n\n## Docker Engine's Security for Docker\n\n### Secure Swarm Mode\n\nê¸°ë³¸ì ìœ¼ë¡œ Docker Swarmì€ managerì™€ workerë¡œ êµ¬ë¶„ë˜ì–´ ë™ì‘í•œë‹¤. managerëŠ” ê¸°ë³¸ì ìœ¼ë¡œ control planeì„ ì œì–´í•˜ê³ , ì „ì²´ ì ì¸ cluster í™˜ê²½ì„ êµ¬ì„±í•˜ë©°, ì‘ì—…ì„ ì ì ˆí•˜ê²Œ ì „ë‹¬í•œë‹¤. ê·¸ë¦¬ê³ , ì „ì²´ì ì¸ application codeë¥¼ ë™ì‘ì‹œí‚¤ëŠ” ê²ƒì´ workerë“¤ì´ ìˆ˜í–‰í•˜ëŠ” ì—­í• ì´ë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ managerì™€ workerë“¤ì€ ëª¨ë‘ ë‹¤ë¥¸ Nodeì´ë‹¤. ë”°ë¼ì„œ, ì´ë“¤ê°„ì˜ í†µì‹ ì„ ìˆ˜í–‰í•  ë•Œì— ì¸ì¦ê³¼ ê°™ì€ ì‘ì—…ì„ í•„ìˆ˜ì ì´ë‹¤. ë”°ë¼ì„œ, Docker Swarmì—ì„œëŠ” ì´ë¥¼ ì§€ì›í•˜ê¸° ìœ„í•´ì„œ managerë¡œ ì„ëª…ëœ nodeë¥¼ CAë¡œ í•˜ì—¬ TLS ì¸ì¦ì„ ìˆ˜í–‰í•œë‹¤. ì´ë¥¼ í†µí•´ì„œ, ì„œë¡œë¥¼ ì¸ì¦í•˜ê³ , ì „ì†¡ ë°ì´í„° ì•”í˜¸í™”ë¥¼ ìˆ˜í–‰í•œë‹¤.  \n  \n\\* control plane vs data plane : í†µì‹ ì„ ì¼ìƒì—ì„œì˜ êµí†µíë¦„ì´ë¼ê³  ë³¸ë‹¤ë©´, control planeì€ ì‹ í˜¸ë“±ê³¼ ê°™ì€ ê·œì¹™ì„ ì˜ë¯¸í•˜ê³ , data planeì€ ì‹¤ì œë¡œ ì´ë™í•˜ëŠ” ì°¨ëŸ‰ë“¤ë¡œ ë¹„ìœ í•  ìˆ˜ ìˆë‹¤. ì¦‰, control planeì€ cluster í™˜ê²½ì—ì„œì˜ ì œì–´ë¥¼ ìœ„í•œ ë°ì´í„°ì´ê³ , data planeì€ ì‹¤ì œë¡œ ì£¼ê³  ë°›ëŠ” ë°ì´í„°ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤.\n\n### Image Scanning\n\nDockerëŠ” ì´ë¯¸ì§€ì—ì„œ ë³´ì•ˆìƒì˜ ì·¨ì•½ì  ì—¬ë¶€ë¥¼ scaní•˜ëŠ” ê¸°ëŠ¥ì„ ê¸°ë³¸ì ìœ¼ë¡œ íƒ‘ì¬í•˜ê³  ìˆë‹¤. ì´ë¥¼ í†µí•´ì„œ, ì´ë¯¸ì§€ê°€ ê°€ì§„ ì·¨ì•½ì  ë“±ì„ íŒŒì•…í•˜ëŠ” ê²ƒì´ ê°€ëŠ¥í•˜ë‹¤.\n\n### Docker Content Trust\n\nDockerëŠ” download ë˜ëŠ” ì‹¤í–‰í•  ì´ë¯¸ì§€ì˜ ì œê³µìë¥¼ ì‹ë³„í•˜ê³  ë¬´ê²°ì„±ì„ ì‰½ê²Œ ì²´í¬í•  ìˆ˜ ìˆë„ë¡ í•˜ê¸° ìœ„í•´ì„œ Docker Content Trustë¥¼ ì œê³µí•œë‹¤. registryì— ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•  ë•Œ, ì§ì ‘ ì„œëª…ì´ ê°€ëŠ¥í•˜ê³ , ì´ë¥¼ í†µí•´ì„œ íŠ¹ì • ì‚¬ìš©ìì— ì˜í•´ì„œ ìƒì„±ë˜ì—ˆìŒì„ í™•ì •í•  ìˆ˜ ìˆë‹¤. ì´ë ‡ê²Œ ì„œëª…ì´ ì¡´ì¬í•´ì•¼ë§Œ pullì´ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •í•˜ëŠ” ê²ƒ ì—­ì‹œ ê°€ëŠ¥í•˜ë‹¤.\n\n### Docker Secrets\n\nDockerì—ì„œ ë³´ì•ˆ ì •ë³´ë¥¼ ì•ˆì „í•˜ê²Œ ë³´ê´€í•˜ê¸° ìœ„í•´ì„œ ê³ ì•ˆëœ ê²ƒìœ¼ë¡œ, íŠ¹ì • íƒ€ê²Ÿì—ì„œ ì•ˆì „í•˜ê²Œ SSH keyì™€ ê°™ì€ ì •ë³´ë¥¼ ì•ˆì „í•˜ê²Œ ì „ë‹¬í•˜ëŠ” ê²ƒ ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.\n\n## Reference\n\n- [ğŸ”— Docker Deep Dive](https://www.oreilly.com/library/view/docker-deep-dive/9781800565135/), Nigel Poulton\n","slug":"docker-security","date":"2021-07-10 19:52","title":"[Docker] Security","category":"Tech","tags":["Docker","Container","Security"],"desc":"í•´ë‹¹ ê¸€ì€ Linuxì—ì„œ dockerë¥¼ ë™ì‘ì‹œí‚¨ë‹¤ëŠ” ê°€ì •í•˜ì— ì‘ì„±í•˜ì˜€ë‹¤. (Windowë„ ëŒ€ë¶€ë¶„ ë™ì¼í•˜ë‹¤ê³  í•œë‹¤.)dockerëŠ” ì—¬ëŸ¬ ê°œì˜ ë³´ì•ˆ ì •ì±…ì„ í¬í•¨í•œë‹¤.ì´ë¥¼ í¬ê²Œ ëˆ„ê°€ ê´€ë¦¬í•˜ëŠëƒì— ë”°ë¼ì„œ ë‘ ê°œì˜ ë¶€ë¥˜ë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆë‹¤.1. OS system (Linux)2. Dockerì´ì „ ê°€ìƒí™”ì™€ ë°˜ê°€ìƒí™”ë¥¼ ë¹„êµí•œ ê¸€ì—ì„œ ë³´ì•˜ë“¯ì´ Container ê¸°ìˆ ì„ ê²°ê³¼ì ìœ¼ë¡œ ë°˜ê°€ìƒí™”ì— í•´ë‹¹í•˜ë©°, ì´ë¥¼ ìœ„í•´ì„œ OSì˜ ì§€ì›ì´ í•„ìš”í•˜ë‹¤. ë”°ë¼ì„œ, ì´ë¥¼ Linux ìì²´ì—ì„œ êµ¬í˜„í•´ì£¼ëŠ” ê²ƒì´ ì¡´ì¬í•˜ê³ , Dockerì—ì„œ Application ë‹¨ì—ì„œ êµ¬í˜„í•œ ë¶€ë¶„ìœ¼ë¡œ ë‚˜ë‰˜ì–´ì§€ëŠ” ê²ƒì´ë‹¤.ë¨¼ì €, Linuxì—ì„œ ì§€ì›í•˜ëŠ” ê°ì¢… securityì— ëŒ€í•´ì„œ ì•Œì•„ë´…ì‹œë‹¤.","thumbnailSrc":"https://euidong.github.io/images/docker-picture.jpg"}]},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"docker-network-1"},"buildId":"zSWbHNES18aBYgh7F-mxp","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>