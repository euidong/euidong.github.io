<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta property="og:type" content="blog"/><meta property="og:site_name" content="JustLog"/><meta property="og:image" content="https://euidong.github.io/logo192.png"/><title>#OpenVSwitch | JustLog</title><meta name="description" content="#OpenVSwitch 관련 Posting"/><meta property="og:description" content="#OpenVSwitch 관련 Posting"/><meta property="og:title" content="#OpenVSwitch | JustLog"/><link rel="canonical" href="https://euidong.github.io/tags/OpenVSwitch"/><meta property="og:url" content="https://euidong.github.io/tags/OpenVSwitch"/><meta name="next-head-count" content="11"/><link rel="icon" href="https://euidong.github.io/favicon.png"/><link rel="apple-touch-icon" href="https://euidong.github.io/logo192.png"/><link rel="preload" href="/_next/static/css/d4ec5c8b3df09443.css" as="style"/><link rel="stylesheet" href="/_next/static/css/d4ec5c8b3df09443.css" data-n-g=""/><link rel="preload" href="/_next/static/css/6dc16d084a5153e5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/6dc16d084a5153e5.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js" id="Adsense-id" data-ad-client="ca-pub-7452732177557701" async="" defer="" data-nscript="beforeInteractive"></script><script src="/_next/static/chunks/webpack-9b312e20a4e32339.js" defer=""></script><script src="/_next/static/chunks/framework-81da43a8dcd978d9.js" defer=""></script><script src="/_next/static/chunks/main-7b6c38cbad60dfcf.js" defer=""></script><script src="/_next/static/chunks/pages/_app-e1becca314de3cda.js" defer=""></script><script src="/_next/static/chunks/675-ae8e8a351ce30ae2.js" defer=""></script><script src="/_next/static/chunks/pages/tags/%5Bsubject%5D-0fc8f67b45fbbd0f.js" defer=""></script><script src="/_next/static/VEdUcpPdkgI5huIkFqtJ7/_buildManifest.js" defer=""></script><script src="/_next/static/VEdUcpPdkgI5huIkFqtJ7/_ssgManifest.js" defer=""></script><script src="/_next/static/VEdUcpPdkgI5huIkFqtJ7/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div class="Layout_wrapper__dKJSz root"><header class="Layout_header__XosLl" style="position:static"><div><button tabindex="1" class="SideBarToggler_search_bar_toggler__CEuUg"><svg stroke="currentColor" fill="none" stroke-width="0" viewBox="0 0 24 24" height="35px" width="35px" xmlns="http://www.w3.org/2000/svg"><path d="M2 6C2 5.44772 2.44772 5 3 5H21C21.5523 5 22 5.44772 22 6C22 6.55228 21.5523 7 21 7H3C2.44772 7 2 6.55228 2 6Z" fill="currentColor"></path><path d="M2 12.0322C2 11.4799 2.44772 11.0322 3 11.0322H21C21.5523 11.0322 22 11.4799 22 12.0322C22 12.5845 21.5523 13.0322 21 13.0322H3C2.44772 13.0322 2 12.5845 2 12.0322Z" fill="currentColor"></path><path d="M3 17.0645C2.44772 17.0645 2 17.5122 2 18.0645C2 18.6167 2.44772 19.0645 3 19.0645H21C21.5523 19.0645 22 18.6167 22 18.0645C22 17.5122 21.5523 17.0645 21 17.0645H3Z" fill="currentColor"></path></svg></button><nav class="SideBar_side_bar__wrapper--close__8Nwnr"><a class="SideBar_side_bar__li__crDBH" tabindex="-1" href="/">Home</a><a class="SideBar_side_bar__li__crDBH" tabindex="-1" href="/tags">Tags</a><a class="SideBar_side_bar__li__crDBH" tabindex="-1" href="/categories/Algorithm">Algorithm<!-- --><span class="SideBar_side_bar__li__cnt__9QV_z">(<!-- -->11<!-- -->)<!-- --></span></a><a class="SideBar_side_bar__li__crDBH" tabindex="-1" href="/categories/Computer%20Architecture">Computer Architecture<!-- --><span class="SideBar_side_bar__li__cnt__9QV_z">(<!-- -->7<!-- -->)<!-- --></span></a><a class="SideBar_side_bar__li__crDBH" tabindex="-1" href="/categories/Tech">Tech<!-- --><span class="SideBar_side_bar__li__cnt__9QV_z">(<!-- -->17<!-- -->)<!-- --></span></a><a class="SideBar_side_bar__li__crDBH" tabindex="-1" href="/categories/Web">Web<!-- --><span class="SideBar_side_bar__li__cnt__9QV_z">(<!-- -->3<!-- -->)<!-- --></span></a><a class="SideBar_side_bar__li__crDBH" tabindex="-1" href="/categories/Memoir">Memoir<!-- --><span class="SideBar_side_bar__li__cnt__9QV_z">(<!-- -->3<!-- -->)<!-- --></span></a><a class="SideBar_side_bar__li__crDBH" tabindex="-1" href="/categories/Paper">Paper<!-- --><span class="SideBar_side_bar__li__cnt__9QV_z">(<!-- -->3<!-- -->)<!-- --></span></a><a class="SideBar_side_bar__li__crDBH" tabindex="-1" href="/categories/Network">Network<!-- --><span class="SideBar_side_bar__li__cnt__9QV_z">(<!-- -->11<!-- -->)<!-- --></span></a><a class="SideBar_side_bar__li__crDBH" tabindex="-1" href="/categories/AI">AI<!-- --><span class="SideBar_side_bar__li__cnt__9QV_z">(<!-- -->20<!-- -->)<!-- --></span></a></nav></div><a class="Logo_logo___yD0t" tabindex="1" href="/"></a><div><button class="SearchBarToggler_search_bar_toggler__3dHbA" tabindex="2"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="25px" width="25px" xmlns="http://www.w3.org/2000/svg"><path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"></path></svg></button></div></header><section><div class="RowCard_row_card__list__background___xFj5"><h1 class="RowCard_row_card__list__title__t4a2h"> OpenVSwitch</h1><label class="RowCard_row_card__list__select__wrapper__TZ4_9"><select class="RowCard_row_card__list__select__dxkxA"><option class="RowCard_row_card__list__select__option__GRKZU">최신순<!-- --></option><option class="RowCard_row_card__list__select__option__GRKZU">AtoZ<!-- --></option><option class="RowCard_row_card__list__select__option__GRKZU">ZtoA<!-- --></option></select></label><ul class="RowCard_row_card__list__wrapper__5Gtgi"><div class="RowCard_row_card__wrapper__kohuv"><a class="RowCard_row_card__thumbnail__wrapper__bedY4" href="/posts/sdn-tutorial"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:200px;height:200px;background:none;opacity:1;border:0;margin:0;padding:0;position:relative"><img alt="SDN Tutorial" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fixed" class="RowCard_row_card__thumbnail__Dh_84" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover"/><noscript><img alt="SDN Tutorial" srcSet="https://euidong.github.io/images/sdn-tuto-hero.jpg?imwidth=256 1x, https://euidong.github.io/images/sdn-tuto-hero.jpg?imwidth=640 2x" src="https://euidong.github.io/images/sdn-tuto-hero.jpg?imwidth=640" decoding="async" data-nimg="fixed" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" class="RowCard_row_card__thumbnail__Dh_84" loading="lazy"/></noscript></span></a><div class="RowCard_row_card__tray__trcA5"><a class="RowCard_row_card__tray__title__lVniM" tabindex="-1" href="/posts/sdn-tutorial">SDN Tutorial</a><div class="RowCard_row_card__tray__date__3cY_j">2022년 6월 3일 19시 54분</div><ul class="RowCard_row_card__tray__tag__qXmOl"><a class="RowCard_row_card__tray__tag__li__7_3Zt" tabindex="-1" href="/tags/SDN"># <!-- -->SDN<!-- --></a><a class="RowCard_row_card__tray__tag__li__7_3Zt" tabindex="-1" href="/tags/Mininet"># <!-- -->Mininet<!-- --></a><a class="RowCard_row_card__tray__tag__li__7_3Zt" tabindex="-1" href="/tags/OpenFlow"># <!-- -->OpenFlow<!-- --></a><a class="RowCard_row_card__tray__tag__li__7_3Zt" tabindex="-1" href="/tags/ONOS"># <!-- -->ONOS<!-- --></a><a class="RowCard_row_card__tray__tag__li__7_3Zt" tabindex="-1" href="/tags/OpenVSwitch"># <!-- -->OpenVSwitch<!-- --></a></ul></div></div></ul></div></section><footer class="Layout_footer__EL5v8"><div class="Layout_footer__copyright__r5baC"><span>Copyright © euidong</span><br/><span>모든 컨텐츠에 대한 저작권은 작성자에게 존재합니다. <!-- --><br/>불법 복제를 통한 상업적 사용을 절대적으로 금지합니다. <!-- --><br/>단, 비상업적 이용의 경우 출처 및 링크를 적용한다면 자유롭게 사용가능 합니다.<!-- --></span><span>Also I use photos by<!-- --> <!-- --><a href="https://unsplash.com/@lorenzoherrera?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" tabindex="-1">Lorenzo Herrera</a> <!-- -->on<!-- --> <!-- --><a href="https://unsplash.com/s/photos/tech?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" tabindex="-1">Unsplash</a></span></div><div class="Layout_footer__contents__YZWSm"><a class="Layout_footer__contents__link__K_TKH" href="https://github.com/euidong" target="_blank" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="60" width="60" xmlns="http://www.w3.org/2000/svg"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg><span>github</span></a><a class="Layout_footer__contents__link__K_TKH" href="https://euidong.github.io/portfolio" target="_blank" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="60" width="60" xmlns="http://www.w3.org/2000/svg"><path d="M6 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm-5 6s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H1zM11 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5zm.5 2.5a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1h-4zm2 3a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1h-2zm0 3a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1h-2z"></path></svg><span>portfolio</span></a><a class="Layout_footer__contents__link__K_TKH" href="https://chrome.google.com/webstore/detail/bonfire/nkooidijgbppkojdgkoafcoppnohdfka?hl=ko" target="_blank" rel="noreferrer"><svg stroke="currentColor" fill="currentColor" stroke-width="0" version="1.1" viewBox="0 0 16 16" height="60" width="60" xmlns="http://www.w3.org/2000/svg"><path d="M5.016 16c-1.066-2.219-0.498-3.49 0.321-4.688 0.897-1.312 1.129-2.61 1.129-2.61s0.706 0.917 0.423 2.352c1.246-1.387 1.482-3.598 1.293-4.445 2.817 1.969 4.021 6.232 2.399 9.392 8.631-4.883 2.147-12.19 1.018-13.013 0.376 0.823 0.448 2.216-0.313 2.893-1.287-4.879-4.468-5.879-4.468-5.879 0.376 2.516-1.364 5.268-3.042 7.324-0.059-1.003-0.122-1.696-0.649-2.656-0.118 1.823-1.511 3.309-1.889 5.135-0.511 2.473 0.383 4.284 3.777 6.197z"></path></svg><span>chat</span></a></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"posts":[{"content":"\n## Intro\n\nSDN을 실제 구현하는 것은 굉장히 어려운 일이다. 따라서, Mininet을 활용하여 가상의 Topology를 통해서 먼저 테스팅을 한 후에 실제로 적용하는 것이 일반적이라고 할 수 있다.\n\n따라서, 해당 Posting에서는 `Mininet`, `OpenFlow`, `Open VSwitch`, `ONOS`를 이용하여 간단한 Tutorial을 수행해볼 것이다. 이 Posting을 통해서 남기고자 하는 것은 SDN을 테스팅하는 절차를 익히는 것이다.\n\n## 0. Tools\n\n먼저 작성자의 실행환경은 MAC OS X로 대부분의 설정은 모두 동일하지만 `XTerminal`은 Window/MAC이 다르기 때문에 Window 전용을 설치해야 한다.\n\n- Host Machine\n  - Virtual Box : [🔗 Download](https://www.virtualbox.org/wiki/Downloads) [🔗 공식사이트](https://www.virtualbox.org/)\n    - VM을 실행시키기 위한 도구, OpenSource이며 무료이기 때문에 많이 사용된다.(v6.1)\n  - Vagrant : [🔗 Download](https://www.vagrantup.com/downloads) [🔗 공식사이트](https://www.vagrantup.com/)\n    - Virtual Environment 구축을 자동화하는 도구(v2.2.19)\n  - XQuartz : [🔗 Download](https://www.xquartz.org/releases/index.html) [🔗 공식사이트](https://www.xquartz.org/)\n    - XTerminal 시스템으로 원격으로 Graphic 시스템을 호스팅하는 도구이다. 즉, `ssh`로 접속한 시스템에서 추가적으로 terminal을 생성하거나 GUI를 요구하는 application을 실행시킬 때 이를 host machine에서 실행할 수 있도록 돕는다.(v2.8.1)\n- Virtual Machine\n  - Mininet : [🔗 Download](http://mininet.org/download/) [🔗 공식사이트](http://mininet.org/)\n    - Network Topology를 가상으로 구성할 뿐만 아니라 추가적인 configuration / testing이 가능한 Virtual Environment Emulator(v2.3.0)\n  - OpenVSwitch : [🔗 Download](https://www.openvswitch.org/download/) [🔗 공식사이트](https://www.openvswitch.org/)\n    - Virtual Switch를 실행시킬 수 있는 tool이다. 이를 통해서, Virtual Machine 내부에서 Virtual Switch를 가동시킬 수 있다.OpenFlow Protocol에 기반한 다양한 API를 내재하고 있기 때문에 이를 통해서 Virtual Switch의 Configuration 등과 같은 작업을 수행할 수도 있다.(v2.9.8)\n  - ONOS : [🔗 Download](https://wiki.onosproject.org/download/) [🔗 공식사이트](https://wiki.onosproject.org/)\n    - Open Network Operation System으로 SDN의 Controller 역할을 수행할 수 있다. 뿐만 아니라 WEB Interface도 제공하며, 다양한 API를 추가적으로 제공하기 때문에 유용하다.(v2.5.7)\n\n## 1. Setup\n\n위에 제시한 Tool을 모두 `Virtual Machine` 내부에 설치해야하지만, 자동으로 해당 tool을 설치하는 `Vagrantfile`을 만들어놓았기 때문에 사용해도 좋을 것이다. 해당 VagrantFile로 build하면 시간이 굉장히 소요될 수 있다. (인터넷 상태에 따라 천차만별이지만, 대략 20분?)\n\n```bash\n$ git clone https://github.com/euidong/virtual-sdn-boilerplate\n$ cd virtual-sdn-boilerplate\n$ vagrant up\n# 접속\n$ vagrant ssh\n```\n\n\u003e **Run ONOS**\n\n```bash\n# In Virtual Machine\n$ cd $ONOS_ROOT\n$ bazel run onos-local\n```\n\n## 2. Scenario를 작성\n\n우선 어떤 상황을 **emulation**할 것인지에 대한 구체적인 계획이 필요하다. 따라서, 이를 먼저 구상해보자. 아래 예시는 단순히 내가 생각한 예시이므로 정확성이런 것은 생각하기 보다는 흐름만을 익혀보자.\n\n```plaintext\n💡 Base Scenario\n\n1. 후지산 인근에서 계속해서 화산활동이 감지되고 있다. 또한, 후지산은 100년 단위로 폭발을 해왔는데 최근 170여 년 동안 폭발이 존재하지 않고 있다. 이로 미루어보았을 때 후지산의 화산폭발은 얼마 남지 않았을 것이라고 추측할 수 있다.\n2. 후지산에서 폭발이 발생하는지를 파악하기 위해서 곳곳에 관측기가 필요하며, 이를 분석할 센터가 안전을 위해 후지산 아래에 존재하며 백업 서버를 별도로 다른 공간에 두고 있다.\n3. 각 관측소에서 서로 간 데이터 공유도 계속해서 발생하는 경우가 빈번하다. =\u003e Horizontal traffic이 많다 -\u003e datacenter와 유사한 형태의 Network -\u003e Spine-Leaf 구조가 적절.\n```\n\n## 3. Topology 구성 with Mininet\n\n먼저, topology를 작성해야한다. 이를 위해서 `Mininet`을 활용한다. 이에 대한 개념 정리는 [🔗 Mininet](/posts/mininet)애 해두었다. Base Scenario의 3번 사항에서 알 수 있듯이 우리의 Topology는 Spine-Leaf 구조를 갖는 것이 적절하다. 따라서, 이를 먼저 표현해보도록 하겠다.\n\n\u003e **Source Code**\n\n- `/vagrant/example/mt-fuji/topo.py`\n\n```python\nfrom mininet.topo import Topo\n\nclass SpineLeaf(Topo):\n  def build(self):\n    s_num = 2\n    l_num = 5\n    h_num = 2\n    spines = []\n    leaves = []\n    hosts = []\n\n    for i in range(s_num):\n      spines.append(self.addSwitch('s%s%s' % (1, i+1)))\n    for i in range(l_num):\n      leaves.append(self.addSwitch('l%s%s' % (2, i+1)))\n      for j in range(s_num):\n        self.addLink(spines[j], leaves[i])\n      for j in range(h_num):\n        hosts.append(self.addHost('h%s%s' % (i+1, j+1)))\n        self.addLink(leaves[i], hosts[i * h_num + j])\n\ntopos = { 'spineleaf': (lambda: SpineLeaf()) }\n```\n\n- 실행\n\n```bash\n$ sudo mn --mac --controller remote --switch ovs --custom /vagrant/example/mt-fuji/topo.py --topo=spineleaf\n```\n\n- 실행 결과\n  - 빨간색 : `Spine Switch`\n  - 청록색 : `Leaf Switch`\n\n![Spine-Leaf Topology](/images/spine-leaf-topo.png)\n\n## 4. Test 환경구축\n\n주로 사용되는 Test 환경용 도구는 다음과 같다.\n\n1. `ping` : 특정 machine 간의 연결 상태를 확인하기 위해서 많이 사용되어진다.\n2. `trace` : `ping`과 유사하지만 지나쳐간 `hop`을 모두 조회 가능하여 좀 더 세부적인 경로를 확인할 때 유용하다.\n3. `iperf` : client와 server 구조로 이루어지며, `tcp`, `udp` packet을 전송할 수 있다. 특정 machine에서는 `server`로 실행시키고, 다른 machine에서 해당 `server`로 data를 보내도록 할 수 있다. `ping`보다 주기적으로, 대용량의 데이터를 보내고 관측할 수 있다.\n4. `wireshark` : 실젤 traffic의 이동을 GUI로 볼 수 있도록 돕는 도구이다.\n5. `ONOS WEB GUI` : ONOS에서는 Web을 통해서 Network 상태와 Traffic을 관측하는 것이 가능하다.\n\n여기서는 `iperf`를 통해서 데이터를 전송하고, `ONOS WEB GUI`를 통해서 traffic을 관측할 것이다.\n\n아래 command를 통해서 `h51`가 위에서 언급한 후지산 아래의 서버가 되고, `h52`가 백업 서버가 되는 상황을 가정하기 위해서 해당 두 위치를 `iperf server`로 지정한다. 그리고 모든 관측소(`h11`, `h12`, ..., `h41`, `h42`)에서 `iperf client`가 되어 traffic을 주기적으로 보내도록 설정한다.\n\n```bash\nmininet\u003e h51 iperf -s -u \u0026\nmininet\u003e h52 iperf -s -u \u0026\n\n# xterm 명령어는 host에 위에서 설명한 XQuartz가 정상적으로 설치되어있어야 작동한다.\nmininet\u003e xterm h11 h12 h21 h22 h31 h32 h41 h42\n\n# 각 client에서 다음과 같은 요청을 전송한다.\n$ iperf -u -c 10.0.0.9 -i1 -t100000000000\n```\n\n![ONOS에서 확인한 모습](/images/sdn-tuto-example-1.png)\n\n## 5. Flow Control\n\n기본적으로 Flow를 제어할 수 있는 방식은 해당 Setting을 수행핼 때, 3가지 방법이 있다.\n\n1. Open vSwitch CLI : OpenFlow Protocol에 기반한 여러 CLI 명령어를 지원한다. 이를 통해서, Flow Table을 직접 작성하는 것이 가능하다.\n2. ONOS REST API : ONOS REST API를 통해서 제어가 가능하다. 이때에는 ONOS가 high level로 추상화한 flow control 방식을 활용해야 한다.(ex. intent) 이는 ONOS를 실행하고 있다면, 다음 url에서 확인이 가능하다. [http://localhost:8181/onos/v1/docs/](http://localhost:8181/onos/v1/docs/)\n3. ONOS CLI : ONOS CLI 명령어를 통해서 제어가 가능하다.\n\n이제부터 해당 세가지 방식을 적절히 활용하여 설정하여 각 Simulation 별로 수행을 해보도록 하겠다.\n\n### Scenario 1\n\n\u003e **중간에 link가 끊어진 경우 with ONOS CLI**\n\n![sdn-tuto-scenario-1](/images/sdn-tuto-scenario-1.png)\n\n먼저 모든 host에서 server로 traffic을 중계해줄 수 있도록 다음과 같이 intent를 설정해줄 수 있다. 특정 host간의 intent를 설정하면 자동으로 경로를 찾아서 routing을 수행해준다. 또한, 특정 연결이 중간에 사라져도 자동으로 경로를 재설정한다.\n\n```bash\nonos\u003e add-host-intent 00:00:00:00:00:01/None 00:00:00:00:00:09/None\nonos\u003e add-host-intent 00:00:00:00:00:02/None 00:00:00:00:00:09/None\nonos\u003e add-host-intent 00:00:00:00:00:03/None 00:00:00:00:00:09/None\nonos\u003e add-host-intent 00:00:00:00:00:04/None 00:00:00:00:00:09/None\nonos\u003e add-host-intent 00:00:00:00:00:05/None 00:00:00:00:00:09/None\nonos\u003e add-host-intent 00:00:00:00:00:06/None 00:00:00:00:00:09/None\nonos\u003e add-host-intent 00:00:00:00:00:07/None 00:00:00:00:00:09/None\nonos\u003e add-host-intent 00:00:00:00:00:08/None 00:00:00:00:00:09/None\n```\n\n이 후에 mininet에서 특정 link를 비활성화시킨다.\n\n```bash\nmininet\u003e link s11 l25 down\n```\n\n![sdn-tuto-scenario-1-result](/images/sdn-tuto-scenario-1-result.png)\n\n### Scenario 2\n\n\u003e **Load Balancing을 통해서 측정 데이터 고르게 분배 with Open Vswitch CLI**\n\n![sdn-tuto-scenario-2](/images/sdn-tuto-scenario-2.png)\n\n이전 Scenario의 intent를 유지한 상태에서 OpenFlow의 Group Table의 `select` type을 활용하면, Load Balancing이 가능하다. 먼저, ONOS CLI에서 외부 flowRule도 받아들이도록 설정한 후\n\n```bash\n$ onos localhost\nonos\u003e cfg set org.onosproject.net.flow.impl.FlowRuleManager allowExtraneousRules True\n```\n\n다음과 같이 group entry 생성 및 flow추가로 구현이 가능하다.\n\n```bash\n$ sudo ovs-ofctl add-group l21 \\\n  \"group_id=1,type=select,bucket=output:1,bucket=output:2\" -O OpenFlow11\n$ sudo ovs-ofctl add-flow l21 in_port=3,actions=group:1 -O OpenFlow11\n$ sudo ovs-ofctl add-flow l21 in_port=4,actions=group:1 -O OpenFlow11\n\n$ sudo ovs-ofctl add-group l22 \\\n  \"group_id=1,type=select,bucket=output:1,bucket=output:2\" -O OpenFlow11\n$ sudo ovs-ofctl add-flow l22 in_port=3,actions=group:1 -O OpenFlow11\n$ sudo ovs-ofctl add-flow l22 in_port=4,actions=group:1 -O OpenFlow11\n\n$ sudo ovs-ofctl add-group l23 \\\n  \"group_id=1,type=select,bucket=output:1,bucket=output:2\" -O OpenFlow11\n$ sudo ovs-ofctl add-flow l23 in_port=3,actions=group:1 -O OpenFlow11\n$ sudo ovs-ofctl add-flow l23 in_port=4,actions=group:1 -O OpenFlow11\n\n$ sudo ovs-ofctl add-group l24 \\\n  \"group_id=1,type=select,bucket=output:1,bucket=output:2\" -O OpenFlow11\n$ sudo ovs-ofctl add-flow l24 in_port=3,actions=group:1 -O OpenFlow11\n$ sudo ovs-ofctl add-flow l24 in_port=4,actions=group:1 -O OpenFlow11\n```\n\n![sdn-tuto-scenario-2-result](/images/sdn-tuto-scenario-2-result.png)\n\n### Scenario 3\n\n\u003e **h51이 down되어 h52로 traffic redirection with Open Vswitch CLI**\n\n![sdn-tuto-scenario-3](/images/sdn-tuto-scenario-3.png)\n\nserver로 가는 Leaf Switch에서 packet의 IP, MAC 주소를 변경하여 Redirection이 가능하다.\n\n```bash\n$ sudo ovs-ofctl add-flow l25 \\\n  \"in_port=1, dl_dst=00:00:00:00:00:09,\n   actions=mod_dl_dst:00:00:00:00:00:10,mod_nw_dst:10.0.0.10,output:4\"\n$ sudo ovs-ofctl ad-flow l25 \\\n  \"in_port=4, dl_src=00:00:00:00:00:10,\n   actions=mod_dl_src:00:00:00:00:00:09,mod_nw_dst:10.0.0.9,output:1\"\n```\n\n![sdn-tuto-scenario-3-result](/images/sdn-tuto-scenario-3-result.png)\n\n### Scenario 4\n\n\u003e **Meter를 이용해서 관측소로 가는 과도한 traffic 차단 with ONOS REST API**\n\n![sdn-tuto-scenario-4](/images/sdn-tuto-scenario-4.png)\n\n특정 Switch에서 특정 port로 나가는 traffic의 최대값을 `500KB/s`로 제한하는 예시이다.\n\n- Meter를 생성하기 위한 REST API  \n  **`/meters/of:000000000000000c`로 POST 요청**\n\n```json\n{\n  \"deviceId\": \"of:000000000000000c\",\n  \"unit\": \"KB_PER_SEC\",\n  \"burst\": true,\n  \"bands\": [\n    {\n      \"type\": \"DROP\",\n      \"rate\": 500,\n      \"burstSize\": 0,\n      \"prec\": 0\n    }\n  ]\n}\n```\n\n- Meter를 특정 Switch에 적용하기 위한 REST API  \n  **`/flows/of:000000000000000c?appId=meter`로 POST 요청**\n\n```json\n{\n  \"priority\": 40000,\n  \"isPermanent\": true,\n  \"deviceId\": \"of:000000000000000c\",\n  \"treatment\": {\n    \"instructions\": [\n      {\n        \"type\": \"METER\",\n        \"meterId\": \"1\"\n      },\n      {\n        \"type\": \"OUTPUT\",\n        \"port\": \"2\"\n      }\n    ]\n  },\n  \"selector\": {\n    \"criteria\": [\n      {\n        \"type\": \"ETH_TYPE\",\n        \"ethType\": \"0x0800\"\n      }\n    ]\n  }\n}\n```\n\n![sdn-tuto-scenario-4-result](/images/sdn-tuto-scenario-4-result.png)\n\n## Reference\n\n- Thumbnail : Photo by [Alina Grubnyak](https://unsplash.com/@alinnnaaaa?utm_source=unsplash\u0026utm_medium=referral\u0026utm_content=creditCopyText) on [Unsplash](https://unsplash.com/s/photos/virtual-network?utm_source=unsplash\u0026utm_medium=referral\u0026utm_content=creditCopyText)\n","slug":"sdn-tutorial","date":"2022-06-03 19:54","title":"SDN Tutorial","category":"Network","tags":["SDN","Mininet","OpenFlow","ONOS","OpenVSwitch"],"desc":"SDN을 실제 구현하는 것은 굉장히 어려운 일이다. 따라서, Mininet을 활용하여 가상의 Topology를 통해서 먼저 테스팅을 한 후에 실제로 적용하는 것이 일반적이라고 할 수 있다.따라서, 해당 Posting에서는 Mininet, OpenFlow, Open VSwitch, ONOS를 이용하여 간단한 Tutorial을 수행해볼 것이다. 이 Posting을 통해서 남기고자 하는 것은 SDN을 테스팅하는 절차를 익히는 것이다.","thumbnailSrc":"https://euidong.github.io/images/sdn-tuto-hero.jpg"}],"params":{"subject":"OpenVSwitch"}},"__N_SSG":true},"page":"/tags/[subject]","query":{"subject":"OpenVSwitch"},"buildId":"VEdUcpPdkgI5huIkFqtJ7","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>